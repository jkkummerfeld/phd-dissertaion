\chapter{Graph Parsing} \label{chp:parsing}

Parses in the Penn Treebank \parencite{ptb} are graph structured, but parsers are typically restricted to tree structures for efficiency and modeling reasons.
In this chapter, we propose a new representation and algorithm for a restricted class of graph structures that are flexible enough to cover almost all treebank structures, yet are restricted enough to admit learning and inference that is almost as efficient as for trees.
In particular, we consider directed, acyclic, one-endpoint-crossing graph structures, which cover most dislocation, shared argumentation, and similar tree-violating linguistic phenomena.
We describe how to convert phrase structure parses, including traces, to our new representation, in a reversible manner.
Our dynamic program uniquely decomposes structures, is sound and complete with respect to a subset of the class of one-endpoint-crossing graphs, and covers $97.7\%$ of the Penn English treebank.
We also implement a proof-of-concept parser that recovers a range of null elements and trace types.
% TODO: Update with results

\section{Background}

Before discussing the motivation for this work and the previous work in this area, we need to mention several concepts from discrete mathematics:

\paragraph{Graph}
A set of vertices and edges.
Here each word is a vertex, plus a root vertex not associated with any word.

\paragraph{Tree}
A graph in which every pair of vertices are connected by a unique path (ignoring directionality on edges).

\paragraph{Cycle}
A sequence of edges that begin and end at the same vertex (here we only allow traversal of edges in the direction indicated by the edge).

\paragraph{Projective}
The linear order of words allows us to define an additional concept: projectivity.
A projective graph can be drawn in a two dimensional half-plane with the vertices on the edge of the plane and without any edges crossing.

\paragraph{One-Endpoint Crossing}
\textcite{ec} defined a space of tree structures named one-endpoint crossing (\oneEC).
To be in the space, every edge in the tree must obey the \oneEC property.
The property states that for a given edge $e$, all the edges that cross $e$ must share an endpoint (treating the edges as undirected).

We generalize \textcite{ec}'s definition of one-endpoint crossing trees to graphs.
The \oneEC property remains the same, we just relax the requirement that the edges form a tree.
To enable efficient parsing we will further restrict the space we consider, not covering a few specific one-endpoint-crossing structures.
In practice, these structures are rarely observed in the PTB, and when they do occur it is usually due to where punctuation attaches. \\

Figure~\ref{fig:venn} shows the space of graphs divided up based on these properties.
Note that by only using subsets of the rules in our algorithm, we could restrict the space of structures we generate to the projective DAG space, the projective tree space, or the \oneEC tree space.
Additionally, versions of these spaces with undirected edges could be easily handled with the same approach we apply.

\begin{figure}
\centering
\scalebox{0.7}{
\input{figures/graph-space}
}
\caption[Venn diagram of graph space by properties]{\label{fig:venn} Venn diagram showing the space of graphs divided into the properties we consider.
DAG stands for Directed Acyclic Graph.
Our algorithm is able to produce structures in the blue hatched region while the standard parsing approach only produces structures in the blue and red cross-hatched region.
\textcite{ec}'s algorithm produces structures in the overlap of the Tree region and the \oneEC region.
Regions are not scaled to reflect the actual number of possible structures of each type.
}
\end{figure}

\subsection{Why Graph Structures?}

Non-projectivity is important in syntax for representing many structures, to the point where Chomsky identifies it as a distinguishing feature of syntax, called displacement \parencite{displacement}.
For the purpose of phrase structure representations, adding non-projective links means we are also creating graphs, as adding any edge to a tree will create a graph.
These examples show some of the ways in which these extra edges are needed to encode the structure of the sentence:

\begin{itemize}
  \item \textbf{Null infinitive subject} \emph{Bob wants to teach}, here \emph{Bob} is both \emph{wanting} and \emph{teaching}, but in a tree \emph{Bob} can only have one parent, and so can't be linked to both.
  \item \textbf{Wh-movement} \emph{When should Bob teach?}, here the tree would not have a connection between \emph{when} and \emph{teach}.
  \item \textbf{Gapping} \emph{I saw Judy in Sydney and Bob in Berkeley}, here the tree would either lack edges indicating the conjunction of \emph{Judy} and \emph{Bob} or lack edges indicating their connections to \emph{saw}.
  \item \textbf{Fronting} \emph{Hard though the journey may be}, here the word \emph{hard} will not be linked to \emph{be} in the tree.
\end{itemize}

Section~\ref{sec:intro-graph} presented the full set of null elements used in the Penn Treebank, which cover a wide range of phenomena.
The annotation guide for the Penn Treebank \parencite{ptb-guide} provides detailed descriptions of all of these structures as well as examples drawn from the data.

\subsection{Previous Algorithms}

As discussed in Section~\ref{sec:intro-graph}, a range of algorithms have been developed for efficient parsing of projective trees.
This efficiency comes from the ability to break the projective tree down into independent pieces.
Since no edge can be crossed, every edge defines a division of the tree into two parts, inside and outside the edge, \myie one piece that includes all of the structure linking words between the two ends of the edge, and another piece for all other words.

Inference over the space of all non-projective graph parses is intractable, but in practice almost all parses are covered by well-defined subsets of this space.
For dependency parsing, recent work has defined algorithms for inference within various subspaces \parencite{Gomez-Rodriguez:2010,ec}.
We build upon these algorithms and adapt them to constituency parsing.
For constituency parsing, a range of alternative formalisms have been developed, starting with Generalized Phrase Structure Grammar \parencite{gpsg}, which used features and slash categories to encode traces.
Further work built on these ideas, forming what was later described as mildly-context sensitive grammar formalisms, including LFG \parencite{Bresnan:1982}, LTAG \parencite{Joshi:1997}, and CCG \parencite{Steedman:2000}.

Our representation is similar to LTAG-Spinal \parencite{Shen:2007}, but has the advantage that it can be converted back into the PTB representation.
Recently, dependency parsers have been used to assist in constituency parsing, which has involved varying degrees of representation design, but only for trees \parencite{hall2007hybrid,hall-nivre:2008:PaGe,kong-rush-smith:2015:NAACL-HLT,fernandezgonzalez-martins:2015:ACL-IJCNLP}.

Previous work on parsing traces and other null elements in the PTB has taken two general approaches.
The first broadly effective system was \textcite{Johnson:2002}, which post-processed the output of a parser, inserting extra elements.
This was effective for some types of structure, such as null complementizers, but had difficulty with long distance dependencies.
One challenge for a post-processing system is that it must deal with parser mistakes--Johnson's system F-score was $7$ points higher on gold trees than on parser output.

The other common approach has been to expand the grammar, threading a trace through the tree structure on the non-terminal symbols.
\textcite{Collins:1997}'s third model used this approach to recover wh-traces, while \textcite{cai-chiang-goldberg:2011} used it to recover null pronouns, and others have used it for a range of movement types \parencite{dienes-dubey:2003,schmid:2006}.
All of these approaches have the disadvantage that each additional trace dramatically expands the grammar.

\section{Overall Algorithm} \label{sec:overall-algorithm}

Our algorithm falls into the dynamic programming class, and specifically the type defined by \textcite{Cocke:1969,Kasami:1966,Younger:1967}.
Algorithm~\ref{alg:general-cky} shows a pseudocode outline of the CKY algorithm.

\begin{algorithm}
\centering
\begin{algorithmic}[]
  \State Initialize with an empty parse item for each position in the sentence
  \For{each possible width, from 1 to the length of sentence}
    \For{each span\footnote{A continuous range, \myeg from 1 to 4 would be a span of width 3} mark of that width}
      \State Create items by combining existing, smaller, items
      \State Create items by adding structure to items with this span
    \EndFor
  \EndFor
\end{algorithmic}
\caption{\label{alg:general-cky}
General CKY algorithm.
}
\end{algorithm}

This algorithm works by exploiting the constraint that the larger problem (find the optimal parse) can be decomposed into independent sub-problems (find the optimal parse for part of the sentence) whose solutions can be combined to solve the original problem (combine the best solution from one span with the best solution from another span).
To turn this into a specific algorithm we need to specify:

\begin{itemize}
  \item What types of items can exist
  \item How items can be combined
  \item How structure can be added to an item
\end{itemize}

The second and third of these needs can be described by deduction rules.
Most of this chapter will be concerned with the definition of these deduction rules and the properties we are able to achieve by our choices.

\section{Sketch of Deduction Rules}

% TODO: Move all pitler et al references into the following section
% TODO: Walk through the example carefully
% TODO: Change the example to more clearly show separate items

\tikzset{% 
  not allowed/.style={%
    dotted,
    very thick,
    color=red
  }
}
\tikzset{% 
  required/.style={%
  }
}
\tikzset{% 
  optional/.style={%
    dashed
  }
}
\tikzset{% 
  pointO/.style={%
    fill=black,regular polygon, regular polygon sides=4,inner sep=1pt
  }
}
\newlength\vertSmall
\newlength\vertBig
\newlength\vertBigger
\newlength\labelGap
\newlength\coordGap

In this section we begin with an introduction to build intuition, then define the item types (\S~\ref{sec:item-types-sketch}), work through an example (\S~\ref{sec:example-derivation}), and sketch the deduction rules for our algorithm (\S~\ref{sec:deduction-rules-sketch}).
In Section~\ref{sec:ec-comparison}, we discuss how it differs from \textcite{ec}'s tree parsing algorithm, and in Section~\ref{sec:full-algorithm} we provide the complete details of the algorithm definition and proof.
Eventually we will show how we can support directed, labeled edges, and labeled words, but to simplify the presentation of the algorithm we first focus on deduction rules for undirected, unlabeled edges and ignore word labels. \\

\noindent
\parbox{4in}{
The intuition for the items is that they are either a continuous span of the sentence, going from one word to another (shown here with a line, intentionally not showing any internal): \\
}\hfill\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \node (w5) at (2, 0) {w$_5$};
  \node (w6) at (3, 0) {w$_6$};
  \draw (w3.north) -- (w6.north);
\end{tikzpicture}\hfill\strut

\noindent
\parbox{4in}{
Or a span plus a point outside the span: \\
}\hfill\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \node (w5) at (2, 0) {w$_5$};
  \node (w6) at (3, 0) {w$_6$};
  \node (w7) at (4, 0) {w$_7$};
  \node (w8) at (5, 0) {w$_8$};
  \draw (w3.north) -- (w6.north);
  \node [pointO] at (w8.north) {};
\end{tikzpicture}\hfill\strut

\noindent
\parbox[c]{2in}{
Whether a word in the item has edges, and whether the item can be modified to give it an edge, depends on its location: \\
}\hfill\begin{tabular}{lcrr}
  \hline
   & & Has & Can get \\
  Location & Example & edges? & edges? \\
  \hline
  \hline
  Within a span & w$_4$, w$_5$ & Yes & No \\
  At the ends of the span & w$_3$, w$_6$ & Maybe & Yes \\
  Between the span and & \multirow{2}{*}{w$_7$} & \multirow{2}{*}{No} & \multirow{2}{*}{No} \\
  the exterior point & & & \\
  At the exterior point & w$_8$ & Yes & Yes \\
  \hline \\
\end{tabular}\hfill\strut

\noindent
\parbox{4in}{
We start out with spans going between each pair of words, with no structure: \\
}\hfill\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \draw (w3.north) -- (w4.north);
\end{tikzpicture}\hfill\strut

\noindent
\parbox{2.5in}{
Our goal is to form a span that covers the entire sentence: \\
}\hfill\begin{tikzpicture}
  \node (w0) at (0, 0) {w$_0$};
  \node (w1) at (1, 0) {w$_1$};
  \node (w2) at (2, 0) {w$_2$};
  \node (w3) at (3, 0) {w$_3$};
  \node (w4) at (4, 0) {w$_4$};
  \node (w5) at (5, 0) {w$_5$};
  \node (w6) at (6, 0) {w$_6$};
  \node (w7) at (7, 0) {w$_7$};
  \node (w8) at (8, 0) {w$_8$};
  \draw (w0.north) -- (w8.north);
\end{tikzpicture}

\noindent
\parbox{4in}{
For items that are just a span, we can create an edge between the endpoints.
An edge added like this is not crossed in the final, complete parse for the sentence. \\
}\hfill\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \draw (w3.north) -- (w4.north);
  \draw [out=90,in=90,dashed] (w3.north) to (w4.north);
\end{tikzpicture}\hfill\strut

\noindent
\parbox{4in}{
For items with an exterior point we gain the option to create edges going between the exterior point and either end of the span.
In the top and middle cases, the edge being added will be crossed at some point later on in the derivation.
In the bottom case, the edge being added will cross one or more existing edges. \\
}\hfill\begin{minipage}{1.5in}
\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \node (w5) at (2, 0) {w$_5$};
  \node (w6) at (3, 0) {w$_6$};
  \node (w7) at (4, 0) {w$_7$};
  \draw (w3.north) -- (w5.north);
  \node [pointO] at (w7.north) {};
  \draw [out=30,in=150,dashed] (w3.north) to (w7.north);
\end{tikzpicture} \\
\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \node (w5) at (2, 0) {w$_5$};
  \node (w6) at (3, 0) {w$_6$};
  \node (w7) at (4, 0) {w$_7$};
  \draw (w3.north) -- (w5.north);
  \node [pointO] at (w7.north) {};
  \draw [out=50,in=130,dashed] (w5.north) to (w7.north);
\end{tikzpicture} \\
\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \node (w5) at (2, 0) {w$_5$};
  \node (w6) at (3, 0) {w$_6$};
  \node (w7) at (4, 0) {w$_7$};
  \draw (w3.north) -- (w5.north);
  \node [pointO] at (w7.north) {};
  \draw [out=50,in=130,dashed] (w3.north) to (w5.north);
\end{tikzpicture} \\
\end{minipage}\hfill\strut

\noindent
\parbox{4in}{
The intuition for the deduction rules is that they combine two or three items with adjacent spans to create a new item.
By carefully deciding which combinations are permitted and which are not, we are able to provide guarantees about the final structure. \\
}\hfill\begin{minipage}{2.5in}
\strut\hfill\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \node (w5) at (2, 0) {w$_5$};
  \draw (0, 0.5) -- (1, 0.5);
  \draw (w4.north) -- (w5.north);
  \draw [out=80,in=110,dashed] (w4.north) to (w5.north);
\end{tikzpicture}\hfill\strut

\strut\hfill$\downarrow$\hfill\strut \\

\strut\hfill\begin{tikzpicture}
  \node (w3) at (0, 0) {w$_3$};
  \node (w4) at (1, 0) {w$_4$};
  \node (w5) at (2, 0) {w$_5$};
  \draw (w3.north) -- (w5.north);
\end{tikzpicture}\hfill\strut
\end{minipage}\hfill\strut

Crucially, the guarantees for the final structure can be made while only tracking certain properties of the sub-parts of the structure along the way.
That means for each item we can store just the max over sub-structures, rather than every individual sub-structure.
That in turn means that when creating a new item, we only consider how to combine these max-structures, not every structure.
As a result, the time complexity of our algorithm does not depend on the number of possible structures (exponential complexity), but instead on the number of possible items (polynomial complexity).

\subsection{Notation}

We use $p$, $q$, etc to refer to word positions.
To indicate ranges we use $[pq]$, $[pq)$, $(pq]$, or $(pq)$, where the bracket variations indicate inclusion, $[]$, or exclusion, $()$, of the endpoint.
To indicate an edge we use two points without brackets, \myeg $pq$.
To define a class of edges we either use a point and a set connected by a dash, \myeg $o$--$(pq)$, or two sets connected by a dash, \myeg $(ps)$--$(sq)$.

\subsection{Item Types} \label{sec:item-types-sketch}

As shown above and in Figure~\ref{fig:alg-example}, our items start and end on words, fully covering the gaps in between\footnote{
This is the inverse of the
conventional constituency parsing approach where items fully cover words and end in the gaps between words.
The idea can be traced back to \textcite{eisner:1996}.
}.
We use six item types, differing in the type of edge crossing they contain: \\

\strut\hfill\begin{tabular}{ll}
  \begin{tikzpicture}
    \node (p) at (0, 0) {$p$};
    \node (q) at (2, 0) {$q$};
    \draw (p.north) -- (q.north);
  \end{tikzpicture} &
  \parbox{0.70\textwidth}{
    \textbf{$I$, Interval}
    A span in which all points in $(pq)$ have a parent in $[pq]$, and no edges exist that go from outside $[pq]$ to points in $(pq)$. \\
  } \\
\end{tabular}\hfill\strut

\strut\hfill\begin{tabular}{ll}
  \begin{tikzpicture}
    \node (p) at (0, 0) {};
    \node (q) at (2, 0) {};
    \node (o) at (3, 0) {$o$};
    \node [pointO] at (o.north) {};
    \draw (p.north) -- (q.north);
    \draw [out=45,in=135] (p.north) to (o.north);
  \end{tikzpicture} &
  \parbox{0.70\textwidth}{
    \textbf{$X$, Exterval}
    An interval plus a single edge between $o$ and either $p$ or $q$, where $o$ is outside $[pq]$. \\
  } \\
\end{tabular}\hfill\strut

\strut\hfill\begin{tabular}{ll}
  \begin{tikzpicture}
    \node (p) at (0, 0) {};
    \node (m1) at (0.4, 0) {};
    \node (m2) at (0.8, 0) {};
    \node (m3) at (1.2, 0) {};
    \node (m4) at (1.6, 0) {};
    \node (q) at (2, 0) {};
    \node (o) at (3, 0) {};
    \draw (p.center) -- (q.center);
    \node [pointO] at (o.center) {};
    \draw [out=45,in=135] (m1.center) to (o.center);
    \draw [out=45,in=135] (m4.center) to (o.center);
    \draw [out=45,in=135] (p.center) to (m2.center);
    \draw [out=45,in=135] (m3.center) to (q.center);
  \end{tikzpicture} &
  \parbox{0.70\textwidth}{
    \textbf{$B$, Both}
    An interval $[pq]$ and a point $o$.
    $o$--$(pq)$ edge may be crossed by $p$--$(pq)$ or $q$--$(pq)$ edges, and at least one crossing of each type occurs.
    $o$--$(pq)$ edges may not be crossed by $(pq)$--$(pq)$ edges. \\
  } \\
\end{tabular}\hfill\strut

\strut\hfill\begin{tabular}{ll}
  \begin{tikzpicture}
    \node (p) at (0, 0) {};
    \node (m) at (0.6, 0) {};
    \node (m2) at (1.2, 0) {};
    \node (q) at (2, 0) {};
    \node (o) at (3, 0) {};
    \draw (p.center) -- (q.center);
    \node [pointO] at (o.center) {};
    \draw [out=45,in=135] (m.center) to (o.center);
    \draw [out=45,in=135] (p.center) to (m2.center);
  \end{tikzpicture} &
  \parbox{0.70\textwidth}{
    \textbf{$L$, Left}
    Same as $B$, but $o$--$(pq)$ edges may only be crossed by $p$--$(pq)$ edges. \\
  } \\
\end{tabular}\hfill\strut

\strut\hfill\begin{tabular}{ll}
  \begin{tikzpicture}
    \node (p) at (0, 0) {};
    \node (m) at (0.6, 0) {};
    \node (m2) at (1.2, 0) {};
    \node (q) at (2, 0) {};
    \node (o) at (3, 0) {};
    \draw (p.center) -- (q.center);
    \node [pointO] at (o.center) {};
    \draw [out=45,in=135] (m2.center) to (o.center);
    \draw [out=45,in=135] (m.center) to (q.center);
  \end{tikzpicture} &
  \parbox{0.70\textwidth}{
    \textbf{$R$, Right}
    Same as $L$, but with edges crossed by $q$--$(pq)$ edges rather than $p$-$(pq)$ edges. \\
  } \\
\end{tabular}\hfill\strut

\strut\hfill\begin{tabular}{ll}
  \begin{tikzpicture}
    \node (p) at (0, 0) {};
    \node (m) at (1, 0) {};
    \node (q) at (2, 0) {};
    \node (o) at (3, 0) {};
    \draw (p.center) -- (q.center);
    \node [pointO] at (o.center) {};
    \draw [out=45,in=135] (m.center) to (o.center);
  \end{tikzpicture} &
  \parbox{0.70\textwidth}{
    \textbf{$N$, Neither}
    An interval and a point, with a least one $o$--$(pq)$ edge.
    $o$--$(pq)$ edges can only be crossed by $pq$, not other $[pq]$--$[pq]$ edges. \\
  }
\end{tabular}\hfill\strut

\subsection{Example Derivation} \label{sec:example-derivation}

Figure~\ref{fig:alg-example} presents a derivation of a sentence with crossing edges, showing examples of several deduction rules.
We define the deduction rules in the next section from a top-down perspective to easily show how well they cover the space of structures.
To build intuition, here we describe the example bottom-up and with more conventional deductive reasoning notation. \\

\noindent
\parbox{4.5in}{
We initialize with items of width one, placing an item between each pair of words. \\
}\hfill\mbox{
  $\emptyset \; \mapsto \; I_{0,1}$
}

\noindent
\parbox{4.5in}{
Our main loop from Algorithm~\ref{alg:general-cky} considers each width and combines items, then adds structure.
We start with items of width one, which cannot be formed by combination.
We can add edges though, such as the \emph{We}--\emph{like} edge, and the \emph{like}--\emph{ROOT} edge.
Note, in the second case the edge creates an Exterval, and the edge will eventually be crossed. \\
}\hfill\parbox{1.5in}{
  $I_{1,2} \; \land \; pq_{1,2} \; \mapsto \; I_{1,2}$ \\
  $I_{0,1} \; \land \; po_{0,2} \; \mapsto \; X_{0,1}$ 
}

\noindent
\parbox{4.5in}{
In the next step we consider items of width two.
We can form an item of width two by combining items either side of \emph{to}: \\
}\hfill\mbox{
  $I_{2,3} \; \land \; I_{3,4} \; \mapsto \; I_{2,4}$
}

\noindent
\parbox{4.5in}{
From (3) to (4) we are still considering items of width two, but now adding edges, such as \emph{We}--\emph{run}.
This edge would not be part of a tree parse, and will be crossed in our complete parse: \\
}\hfill\mbox{
  $I_{2,4} \; \land \; po_{1,4} \; \mapsto \; X_{2,4}$ 
}

\noindent
\parbox{4.5in}{
Next, a width four item is formed by combining items either side of \emph{run}.
This creates a Neither item, as there is an uncrossed edge from the external point to within the span.
Note that we can determine it is an $N$ with only limited information about the internal structure of the items being combined. \\
}\hfill\mbox{
  $X_{2,4} \; \land \; I_{462} \; \mapsto \; N_{2,6}$
}

\noindent
\parbox{4.5in}{
Going from (5) to (6) we introduce our first crossing of edges.
The new edge, \emph{.}--\emph{like}, crosses the edge added two steps ago. \\
}\hfill\mbox{
  $N_{2,6} \; \land \; po_{2,6} \; \mapsto \; N_{2,4}$ 
}

\noindent
\parbox{4in}{
Finally, we combine three items to form the complete derivation. \\
}\hfill\mbox{
  $X_{0,1} \; \land \; I_{1,2} \land N_{2,6} \; \mapsto \; I_{0,6}$
}

\begin{figure}
\centering
\vspace{-5mm}
\input{figures/picture-algorithm}
\caption{\label{fig:alg-example}
An example derivation using our graph parsing deduction rules.
}
\end{figure}

\begin{landscape}
\input{figures/algorithm-flow}
\end{landscape}

\subsection{Deduction Rules} \label{sec:deduction-rules-sketch}

\newlength{\deductionCaptionLength}
\newlength{\deductionRuleLength}
\setlength{\deductionCaptionLength}{0.35\textwidth}
\setlength{\deductionRuleLength}{0.95\textwidth}

One set of deduction rules is concerned with removing direct edges between the points $p$, $q$, and $o$ in each item.
These are straightforward, so we leave them for the full derivation in Section~\ref{sec:full-algorithm}.
The other type of deduction rules, which we sketch below, involve decomposing an item into parts.

To make the deduction rules manageable, we define some constraints explicitly, and then use code to enumerate all options and enforce additional constraints.
Here we describe the explicit constraints and the reasoning behind them.

When parsing, we simply have a list of valid rules and consider any way of combining items that satisfies a rule.
To define the rules, we need to consider each of our item types and define a unique decomposition into smaller pieces.
Figure~\ref{fig:deduction-defs} gives an overview of how this process works.
For some item types, such as $X$, every possible structure can be broken down into pieces in the same way.
For others, such as $L$, how the item is broken down depends on some properties of its structure.
Below we work through each path in Figure~\ref{fig:deduction-defs}, specifying the questions more precisely and then providing the decomposition.

\subsubsection{Interval}\label{sec:interval}
Is there a $p$--$(pq)$ edge? \\
No, then split at $p+1$: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (hlref) at (0, 0) {};
  \node (hmref) at (1, 0) {};
  \node (hrref) at (4, 0) {};

  \node (p0) at (hlref) {};
  \node (s0a) at (hmref) {};
  \node (v0bref) [below=\vertSmall of p0.center] {};
  \node (s0b) at (v0bref -| hmref) {};
  \node (q0) at (v0bref -| hrref) {};
  \node (label0) [left=\labelGap of p0] {$I$};
  \node (label0) [left=\labelGap of v0bref] {$I$};
  \draw (p0.center) -- (s0a.center);
  \draw (s0b.center) -- (q0.center);

  \node (lb) at (v0bref -| hlref) {};
  \node (sb) at (v0bref -| hmref) {};
  \node (rb) at (v0bref -| hrref) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut ${p+1}$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-interval-a} Deduction rule $I_0$}}}
\end{minipage}
\vspace{5mm}

\noindent
Yes, then consider $ps$, the longest $p$--$(pq)$ edge. \\
Do any edges cross $ps$? \\
No, then split at $s$: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (hlref) at (0, 0) {};
  \node (hmref) at (2, 0) {};
  \node (hrref) at (4, 0) {};

  \node (p0) at (hlref) {};
  \node (s0a) at (hmref) {};
  \node (v0bref) [below=\vertSmall of p0.center] {};
  \node (s0b) at (v0bref -| hmref) {};
  \node (q0) at (v0bref -| hrref) {};
  \node (label0) [left=\labelGap of p0] {$I$};
  \node (label0) [left=\labelGap of v0bref] {$I$};
  \draw (p0.center) -- (s0a.center);
  \draw (s0b.center) -- (q0.center);
  \draw [required,out=30,in=150] (p0.center) to (s0a.center);

  \node (lb) at (v0bref -| hlref) {};
  \node (sb) at (v0bref -| hmref) {};
  \node (rb) at (v0bref -| hrref) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-interval-b} Deduction rule $I_1$}}}
\end{minipage}
\vspace{5mm}

\noindent
Yes, then consider the set of edges $C$, that cross $ps$.
If $|C| > 1$, let $t$ be the common endpoint of all edges in $C$ (they must have a common endpoint to satisfy the \oneEC property for $ps$).
If $|C| = 1$, let $t$ be the endpoint outside $ps$.

\noindent
Is $s < t$ and are there any $s$--$(tq)$ edges? \\
Yes to both: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (ls) at (0.5, 0) {};
  \node (s) at (1.5, 0) {};
  \node (t) at (2.5, 0) {};
  \node (tr) at (3.5, 0) {};
  \node (r) at (4, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| s) {};
  \node (o0) at (v0 -| t) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$R$ or $N$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| s) {};
  \node (q1) at (v1 -| t) {};
  \node (label1) [left=\labelGap of v1] {$I$};
  \node (v2) [below=\vertSmall of v1.center] {};
  \node (p2) at (v2 -| t) {};
  \node (q2) at (v2 -| r) {};
  \node (o2) at (v2 -| s) {};
  \node [pointO] at (o2) {};
  \node (label2) [left=\labelGap of v2] {$L$, $N$ or $X$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw (p2.center) -- (q2.center);
  \draw [required,out=30,in=150] (p0.center) to (q0.center);
  \draw [required,out=150,in=30] (o0.center) to (v0 -| ls);
  \draw [required,out=30,in=150] (o2.center) to (v2 -| tr);

  \node (lb) at (v2 -| l) {};
  \node (tb) at (v2 -| t) {};
  \node (sb) at (v2 -| s) {};
  \node (rb) at (v2 -| r) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (ttext) [below=\coordGap of tb.center] {\small \strut $t$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-interval-d} Deduction rule $I_2$}}}
\end{minipage}
\vspace{5mm}

\noindent
Yes $s < t$, no $s$--$(tq)$ edges (in this case it is also possible that $t = q$, in which case there is no $[tq]$ item): \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (ls) at (0.5, 0) {};
  \node (s) at (1.5, 0) {};
  \node (t) at (2.5, 0) {};
  \node (tr) at (3.5, 0) {};
  \node (r) at (4, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| s) {};
  \node (o0) at (v0 -| t) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$B$, $L$, $R$ or $N$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| s) {};
  \node (q1) at (v1 -| t) {};
  \node (label1) [left=\labelGap of v1] {$I$};
  \node (v2) [below=\vertSmall of v1.center] {};
  \node (p2) at (v2 -| t) {};
  \node (q2) at (v2 -| r) {};
  \node (label2) [left=\labelGap of v2] {$I$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw (p2.center) -- (q2.center);
  \draw [required,out=30,in=150] (p0.center) to (q0.center);
  \draw [required,out=150,in=30] (o0.center) to (v0 -| ls);

  \node (lb) at (v2 -| l) {};
  \node (tb) at (v2 -| t) {};
  \node (sb) at (v2 -| s) {};
  \node (rb) at (v2 -| r) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (ttext) [below=\coordGap of tb.center] {\small \strut $t$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-interval-c} Deduction rule $I_3$}}}
\end{minipage}
\vspace{5mm}

\noindent
Now consider $s > t$.
In this case $C > 1$ by construction.
Are there any $p$--$(ts)$ edges? \\
Yes: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (t) at (1.5, 0) {};
  \node (ts) at (2, 0) {};
  \node (s) at (2.5, 0) {};
  \node (sr1) at (3, 0) {};
  \node (sr2) at (3.5, 0) {};
  \node (r) at (4, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| t) {};
  \node (label0) [left=\labelGap of v0] {$I$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| t) {};
  \node (q1) at (v1 -| s) {};
  \node (o1) at (v1 -| p) {};
  \node [pointO] at (o1) {};
  \node (label1) [left=\labelGap of v1] {$L$ or $N$};
  \node (v2) [below=\vertSmall of v1.center] {};
  \node (p2) at (v2 -| s) {};
  \node (q2) at (v2 -| r) {};
  \node (o2) at (v2 -| t) {};
  \node [pointO] at (o2) {};
  \node (label2) [left=\labelGap of v2] {$N$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw (p2.center) -- (q2.center);
  \draw [required,out=30,in=150] (o1.center) to (q1.center);
  \draw [required,out=30,in=150] (o1.center) to (v1 -| ts);
  \draw [required,out=30,in=150] (o2.center) to (v2 -| sr1);
  \draw [required,out=30,in=150] (o2.center) to (v2 -| sr2);

  \node (lb) at (v2 -| l) {};
  \node (tb) at (v2 -| t) {};
  \node (sb) at (v2 -| s) {};
  \node (rb) at (v2 -| r) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (ttext) [below=\coordGap of tb.center] {\small \strut $t$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-interval-f} Deduction rule $I_4$}}}
\end{minipage}
\vspace{5mm}

\noindent
No: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (t) at (1.5, 0) {};
  \node (ts) at (2, 0) {};
  \node (s) at (2.5, 0) {};
  \node (sr1) at (3, 0) {};
  \node (sr2) at (3.5, 0) {};
  \node (r) at (4, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| t) {};
  \node (o0) at (v0 -| s) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$R$, $N$ or $X$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| t) {};
  \node (q1) at (v1 -| s) {};
  \node (label1) [left=\labelGap of v1] {$I$};
  \node (v2) [below=\vertSmall of v1.center] {};
  \node (p2) at (v2 -| s) {};
  \node (q2) at (v2 -| r) {};
  \node (o2) at (v2 -| t) {};
  \node [pointO] at (o2) {};
  \node (label2) [left=\labelGap of v2] {$N$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw (p2.center) -- (q2.center);
  \draw [required,out=30,in=150] (p0.center) to (o0.center);
  \draw [required,out=30,in=150] (o2.center) to (v2 -| sr1);
  \draw [required,out=30,in=150] (o2.center) to (v2 -| sr2);

  \node (lb) at (v2 -| l) {};
  \node (tb) at (v2 -| t) {};
  \node (sb) at (v2 -| s) {};
  \node (rb) at (v2 -| r) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (ttext) [below=\coordGap of tb.center] {\small \strut $t$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-interval-e} Deduction rule $I_5$}}}
\end{minipage}
\vspace{5mm}

\subsubsection{Exterval} \label{sec:alg:exterval}
No decomposition rules are needed, as the removal of the $op$ or $oq$ edge leaves behind an Interval.

\subsubsection{Both} \label{sec:alg:both}
Consider the case when $o$ is to the right (the case when $o$ is to the left is symmetrical).
Consider $ps_p$, the longest $p$--$(pq)$ edge. \\
Does $ps_p$ cross any $q$--$(pq)$ edges? \\
Yes: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (t) at (1.5, 0) {};
  \node (ts) at (2, 0) {};
  \node (s) at (2.5, 0) {};
  \node (sr1) at (3, 0) {};
  \node (sr2) at (3.5, 0) {};
  \node (r) at (4, 0) {};
  \node (o) at (5, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| t) {};
  \node (o0) at (v0 -| s) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$R$, $N$ or $X$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| t) {};
  \node (q1) at (v1 -| s) {};
  \node (o1) at (v1 -| o) {};
  \node [pointO] at (o1) {};
  \node (label1) [left=\labelGap of v1] {$X'$};
  \node (v2) [below=\vertSmall of v1.center] {};
  \node (p2) at (v2 -| s) {};
  \node (q2) at (v2 -| r) {};
  \node (o2) at (v2 -| t) {};
  \node [pointO] at (o2) {};
  \node (label2) [left=\labelGap of v2] {$L$, $N$ or $X$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw (p2.center) -- (q2.center);
  \draw [required,out=30,in=150] (p0.center) to (o0.center);
  \draw [required,out=30,in=150] (o2.center) to (q2.center);
  \draw [required,out=20,in=160] (p1.center) to (o1.center);
  \draw [required,out=20,in=160] (q1.center) to (o1.center);

  \node (lb) at (v2 -| l) {};
  \node (tb) at (v2 -| t) {};
  \node (sb) at (v2 -| s) {};
  \node (rb) at (v2 -| r) {};
  \node (ob) at (v2 -| o) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (ttext) [below=\coordGap of tb.center] {\small \strut $s_p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s_q$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
  \node (otext) [below=\coordGap of ob.center] {\small \strut $o$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-both-fail-a} Excluded $B$ deduction rule}}}
\end{minipage}
\vspace{5mm}

The extra edges shown must be present because of the definition of $B$ items and the \oneEC property.
The $X'$ is a slight variation on our $X$, since it has both $s_qo$ and $s_po$.
We do not include this rule because it would be $O(n^5)$, and this specific structure is almost never observed in the treebank.

\noindent
Now consider the alternative, when $ps_p$ does not cross any $q$--$(pq)$ edges.
In this case the possibilities follow a pattern: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\parbox{3in}{
\begin{tikzpicture}
  \node (p) at (1, 0) {};
  \node (m0) at (1.5, 0) {};
  \node (sp) at (2, 0) {};
  \node (sq) at (4, 0) {};
  \node (m1) at (4.5, 0) {};
  \node (q) at (5, 0) {};
  \node (o) at (6, 0) {};
  \node [pointO] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (sp.north);
  \draw [out=45,in=135] (sq.north) to (q.north);
  \draw [out=20,in=160] (m0.north) to (o.north);
  \draw [out=20,in=160] (m1.north) to (o.north);
\end{tikzpicture} \\
\begin{tikzpicture}
  \node (p) at (1, 0) {};
  \node (m0) at (1.5, 0) {};
  \node (sp) at (2, 0) {};
  \node (m2) at (2.5, 0) {};
  \node (sq) at (4, 0) {};
  \node (m1) at (4.5, 0) {};
  \node (q) at (5, 0) {};
  \node (o) at (6, 0) {};
  \node [pointO] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (sp.north);
  \draw [out=45,in=135] (sq.north) to (q.north);
  \draw [out=25,in=155] (m0.north) to (m2.north);
  \draw [out=20,in=160] (m0.north) to (o.north);
  \draw [out=20,in=160] (m1.north) to (o.north);
\end{tikzpicture} \\
\begin{tikzpicture}
  \node (p) at (1, 0) {};
  \node (m0) at (1.5, 0) {};
  \node (s) at (2, 0) {};
  \node (m2) at (2.5, 0) {};
  \node (m3) at (3, 0) {};
  \node (sq) at (4, 0) {};
  \node (m1) at (4.5, 0) {};
  \node (q) at (5, 0) {};
  \node (o) at (6, 0) {};
  \node [pointO] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (sq.north) to (q.north);
  \draw [out=25,in=155] (m0.north) to (m2.north);
  \draw [out=20,in=160] (m0.north) to (o.north);
  \draw [out=20,in=160] (m1.north) to (o.north);
  \draw [out=25,in=155] (s.north) to (m3.north);
\end{tikzpicture} \\
\begin{tikzpicture}
  \node (p) at (1, 0) {};
  \node (m0) at (1.5, 0) {};
  \node (s) at (2, 0) {};
  \node (m2) at (2.5, 0) {};
  \node (m3) at (3, 0) {};
  \node (m4) at (3.5, 0) {};
  \node (sq) at (4, 0) {};
  \node (m1) at (4.5, 0) {};
  \node (q) at (5, 0) {};
  \node (o) at (6, 0) {};
  \node [pointO] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (sq.north) to (q.north);
  \draw [out=25,in=155] (m0.north) to (m2.north);
  \draw [out=20,in=160] (m0.north) to (o.north);
  \draw [out=20,in=160] (m1.north) to (o.north);
  \draw [out=25,in=155] (s.north) to (m3.north);
  \draw [out=25,in=155] (m2.north) to (m4.north);
\end{tikzpicture} \\
\begin{tikzpicture}
  \node (p) at (1, 0) {};
  \node (m0) at (1.5, 0) {};
  \node (s) at (2, 0) {};
  \node (m2) at (2.5, 0) {};
  \node (m3) at (3, 0) {};
  \node (m4) at (3.5, 0) {};
  \node (sq) at (4, 0) {};
  \node (m1) at (4.5, 0) {};
  \node (q) at (5, 0) {};
  \node (o) at (6, 0) {};
  \node [pointO] at (o.north) {};
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (sq.north) to (q.north);
  \draw [out=25,in=155] (m0.north) to (m2.north);
  \draw [out=20,in=160] (m0.north) to (o.north);
  \draw [out=20,in=160] (m1.north) to (o.north);
  \draw [out=25,in=155] (s.north) to (m3.north);
  \draw [out=25,in=155] (m2.north) to (m4.north);
  \draw [out=25,in=155] (m4.north) to (m1.north);
  \draw [out=25,in=155] (m3.north) to (sq.north);
  \node [fill=white] (dots) at (3,0.25) {\small . . .};
  \draw (p.north) -- (q.north);
\end{tikzpicture}
}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-both-fail-b} $B$ structural pattern}}}
\end{minipage}
\vspace{5mm}

Does the pattern go all the way to the right, as shown in the last case? \\
Yes:

\begin{center}
\parbox{0.65\textwidth}{
We cannot define a simple decomposition of the structure using our item types.
By eliminating this case we restrict ourselves to a subset of one-endpoint-crossing graphs.
This does not decrease treebank coverage. \\
}
\end{center}

\noindent
No, then use the end of the edge crossing pattern as $s$ and decompose the item as: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (ls) at (1, 0) {};
  \node (s) at (2, 0) {};
  \node (sr) at (3, 0) {};
  \node (r) at (4, 0) {};
  \node (o) at (5, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| s) {};
  \node (o0) at (v0 -| o) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$L$ or $N$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| s) {};
  \node (q1) at (v1 -| r) {};
  \node (o1) at (v1 -| o) {};
  \node [pointO] at (o1) {};
  \node (label1) [left=\labelGap of v1] {$R$ or $N$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw [optional,out=30,in=150] (p0.center) to (q0.center);
  \draw [optional,out=30,in=150] (p1.center) to (q1.center);
  \draw [required,out=20,in=160] (v0 -| ls) to (o0.center);
  \draw [required,out=30,in=150] (v1 -| sr) to (o1.center);

  \node (lb) at (v1 -| l) {};
  \node (sb) at (v1 -| s) {};
  \node (rb) at (v1 -| r) {};
  \node (ob) at (v1 -| o) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
  \node (otext) [below=\coordGap of ob.center] {\small \strut $o$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-both} Deduction rule $B$}}}
\end{minipage}
\vspace{5mm}

The dashed edges are required for the $N$ items, but not the $L$ items.
Below we describe how to check that the chaining pattern is present in an $L$, but in practice we avoid it entirely by requiring the $L$ to have the edge $ps$, with no loss in coverage.

\subsubsection{Left and Right}
These are defined symmetrically.
Consider the $o$--$(pq)$ edges in an $L$.
Use the edge $os$ with $s$ furthest from $p$ to define the split point.

\noindent
Is $os$ crossed by any $p$--$(pq)$ edges? \\
No: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (ls) at (1, 0) {};
  \node (s) at (2, 0) {};
  \node (sr) at (3, 0) {};
  \node (r) at (4, 0) {};
  \node (o) at (5, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| s) {};
  \node (o0) at (v0 -| o) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$L$ or $N$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| s) {};
  \node (q1) at (v1 -| r) {};
  \node (label1) [left=\labelGap of v1] {$I$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw [required,out=20,in=160] (q0.center) to (o0.center);
  \draw [required,out=160,in=20] (o0.center) to (v0 -| ls);

  \node (lb) at (v1 -| l) {};
  \node (sb) at (v1 -| s) {};
  \node (rb) at (v1 -| r) {};
  \node (ob) at (v1 -| o) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
  \node (otext) [below=\coordGap of ob.center] {\small \strut $o$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[c]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-left-c} Deduction rule $L_0$}}}
\end{minipage}
\vspace{5mm}

\noindent
Yes, then is $os$ the only $o$--$(pq)$ edge? \\
No: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (ls) at (1, 0) {};
  \node (s) at (2, 0) {};
  \node (sr) at (3, 0) {};
  \node (r) at (4, 0) {};
  \node (o) at (5, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| s) {};
  \node (o0) at (v0 -| o) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$L$ or $N$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| s) {};
  \node (q1) at (v1 -| r) {};
  \node (o1) at (v1 -| l) {};
  \node [pointO] at (o1) {};
  \node (label1) [left=\labelGap of v1] {$N$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw [required,out=20,in=160] (q0.center) to (o0.center);
  \draw [required,out=20,in=160] (v0 -| ls) to (o0.center);
  \draw [required,out=20,in=160] (o1.center) to (v1 -| sr);

  \node (lb) at (v1 -| l) {};
  \node (sb) at (v1 -| s) {};
  \node (rb) at (v1 -| r) {};
  \node (ob) at (v1 -| o) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
  \node (otext) [below=\coordGap of ob.center] {\small \strut $o$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-left-a} Deduction rule $L_1$}}}
\end{minipage}
\vspace{5mm}

\noindent
Yes: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (ls) at (1, 0) {};
  \node (s) at (2, 0) {};
  \node (sr) at (3, 0) {};
  \node (r) at (4, 0) {};
  \node (o) at (5, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| s) {};
  \node (o0) at (v0 -| o) {};
  \node [pointO] at (o0) {};
  \node (label0) [left=\labelGap of v0] {$X$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| s) {};
  \node (q1) at (v1 -| r) {};
  \node (o1) at (v1 -| l) {};
  \node [pointO] at (o1) {};
  \node (label1) [left=\labelGap of v1] {$L$ or $N$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw [required,out=20,in=160] (q0.center) to (o0.center);
  \draw [required,out=20,in=160] (o1.center) to (v1 -| sr);

  \node (lb) at (v1 -| l) {};
  \node (sb) at (v1 -| s) {};
  \node (rb) at (v1 -| r) {};
  \node (ob) at (v1 -| o) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
  \node (otext) [below=\coordGap of ob.center] {\small \strut $o$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-left-b} Deduction rule $L_2$}}}
\end{minipage}
\vspace{5mm}

We also have to track whether there are multiple edges or only a single $o$--$(pq)$ edge, to avoid derivational ambiguity in the $I$ decomposition.
The top and bottom cases lead to multiple such edges, while the middle case will only have one.

We could also track the chaining property discussed in the previous section.
The property is only true in the following cases: when the edge $pq$ is present, when an $X$ is combined with an $L$ that has the property, and when an $X$ is combined with an $N$ that has the $pq$ edge.

\subsubsection{Neither}
Consider the $o$--$(pq)$ edges.
Use the edge $os$ with $s$ furthest from $o$ to define the split point.
The case with $o$ to the left is symmetrical to the case with $o$ on the right, which is: \\

\noindent
\begin{minipage}{\deductionRuleLength}
\centering
\hfill\begin{tikzpicture}
  \pgfmathsetlength{\vertSmall}{2ex}
  \pgfmathsetlength{\labelGap}{1ex}
  \pgfmathsetlength{\coordGap}{-0.5ex}
  \node (l) at (0, 0) {};
  \node (ls) at (1, 0) {};
  \node (s) at (2, 0) {};
  \node (sr) at (3, 0) {};
  \node (r) at (4, 0) {};
  \node (o) at (5, 0) {};

  \node (v0) at (l) {};
  \node (p0) at (v0 -| l) {};
  \node (q0) at (v0 -| s) {};
  \node (label0) [left=\labelGap of v0] {$I$};
  \node (v1) [below=\vertSmall of v0.center] {};
  \node (p1) at (v1 -| s) {};
  \node (q1) at (v1 -| r) {};
  \node (o1) at (v1 -| o) {};
  \node [pointO] at (o1) {};
  \node (label1) [left=\labelGap of v1] {$N$ or $X$};
  \draw (p0.center) -- (q0.center);
  \draw (p1.center) -- (q1.center);
  \draw [required,out=20,in=160] (p1.center) to (o1.center);

  \node (lb) at (v1 -| l) {};
  \node (sb) at (v1 -| s) {};
  \node (rb) at (v1 -| r) {};
  \node (ob) at (v1 -| o) {};
  \node (ltext) [below=\coordGap of lb.center] {\small \strut $p$};
  \node (stext) [below=\coordGap of sb.center] {\small \strut $s$};
  \node (rtext) [below=\coordGap of rb.center] {\small \strut $q$};
  \node (otext) [below=\coordGap of ob.center] {\small \strut $o$};
\end{tikzpicture}\hfill
\raisebox{4mm}{\parbox[b]{\deductionCaptionLength}{\captionof{figure}{\label{fig:rule-neither} Deduction rule $N$}}}
\end{minipage}
\vspace{5mm}

Again, we need to track whether there are multiple $o$--$pq$ edges.
When a sub-item is an $X$ there is only one $o$--$(pq)$ edge, and when it is an $N$ there is more than one.

\section{Comparison with \textcite{ec}} \label{sec:ec-comparison}

Our algorithm is based on \textcite{ec}, which had the crucial ideas of one-endpoint crossing, isolated crossing regions, and the decomposition that we modify.
Our changes give several overall benefits:

\begin{itemize}
  \item Extending to graph structures, which introduces particular challenges for the $B$ item type.
  \item Avoiding derivational ambiguity, where a single parse can be decomposed in multiple ways.
  \item Changes that give new intuition about how the algorithm works, by being able to give guarantees about whether edges will be crossed at the time they are created.
  \item A somewhat more concise overall algorithm definition, mainly due to our use of a combination of templates and code to generate the final rules.
\end{itemize}

Below we provide some specific notes on where changes occurred and why.

\paragraph{Intuition}
The clean division of cases between edges that will be crossed and those that will not be is partially due to choices we made in the definition of the deduction rules; it does not hold for \textcite{ec}'s algorithm.

\paragraph{Items}
We have one entirely new item type, the Exterval, and we have added requirements for the later items.
Specifically, while the allowed crossings are the same, we add the requirment that at least one crossing of the specified type exists (this is also reflected in the renaming of their $LR$ item to $B$).
These changes are necessary to avoid derivational ambiguity when a structure falls into multiple classes.
Enforcing these difference involves changes throughout the deduction rules.

\paragraph{Interval}
One source of ambiguity in their algorithm arises when an edge is crossed by only one other edge.
The ambiguity is in the choice of the second split point, $t$, which could be either end of the crossing edge in their derivation.
In that circumstance we require it to be the endpoint further from $p$ (see the discussion after Figure~\ref{fig:rule-interval-b}).

\paragraph{Both}
The difficult cases we discuss do not come up in their algorithm.
This is due to a combination of the tree constraints they apply, the need to form a complete structure, and use of directed edges.
For the normal $B$ case, the choice of split point is a source of derivational ambiguity in their algorithm.

\paragraph{Left and Right}
Our decomposition of this item differs from their's in several ways because of our decision to separate edge creation and item combination, and because we need to track if there are multiple edges to the external point.

\paragraph{Neither}
As for $L$ and $R$, our decomposition differs because of our altered definition of $N$, and the need to track if there are multiple edges to the external point.

\section{Deduction Rule Definitions and Completeness Proof} \label{sec:full-algorithm}

Above we provided only a sketch of the algorithm, here we explain the full derivation.
For completeness, some of the content is repeated.
When showing the possible deduction rules for each item type we show figures that indicate the required characteristics in each case.
In the figures black solid curves indicate edges that must exist, and red dotted curves are edges that are not allowed, either by construction or due to constraints.

\subsection{Notation}

To indicate a range we use $[pq]$, $[pq)$, $(pq]$, or $(pq)$, where the bracket variations indicate inclusion, $[]$, or exclusion, $()$, of the endpoint.
We also used $[pq]$ to indicate a span without an external point, and $[pq.o]$ to indicate a span with external point $o$.
To indicate edges we either use two points without brackets, \myeg $pq$, or a point and a set connected by a hyphen, \myeg $o$--$(pq)$, or two sets connected by a hyphen, \myeg $(ps)$--$(sq)$.

\subsection{Item Types}

We use six item types, differing in the type of edge crossing they contain.
Each consists of a span, $[pq]$ and an optional point outside the span, $o$, either to the left or right:

\begin{description}
  \item[$I$ - Interval]
  A span in which all points in $(pq)$ have a parent in $[pq]$, and no edges exist that go from outside $[pq]$ to points in $(pq)$.
  \item[$X$ - Exterval (an external point + an Interval)]
  An interval plus exactly one of the edges $op$ or $oq$, where $o$ is outside $[pq]$.
  \item[$N$ - Neither]
  An interval $[pq]$ and a point $o$, with a least one $o$--$(pq)$ edge.
  $o$--$(pq)$ edges can be crossed by the edge $pq$, but not by any other $[pq]$--$[pq]$ edge.
  \item[$L$ - Left]
  Same as $N$, but $o$--$(pq)$ edges may be crossed by $p$--$(pq)$ edges. Also, such a crossing occurs at least once. 
  \item[$R$ - Right]
  Same as $L$, but with $o$--$(pq)$ edges crossed by $q$--$(pq)$ edges rather than $p$-$(pq)$ edges.
  \item[$B$ - Both]
  Same as $L$, but $o$--$(pq)$ edges may also be crossed by $q$--$(ps)$ edges, and at least one crossing of each type occurs.
\end{description}

\subsection{Complete Dynamic Program}

\begin{algorithm}
\vspace{-2mm}
\input{rules-all}
\vspace{-10mm}
\caption{
  \label{fig:complete-dp}
  Complete graph parsing dynamic program.
}
\end{algorithm}

Figure~\ref{fig:complete-dp} shows the templates for the complete dynamic program.
The notation used is as follows:

The notation for edges is $A[p \; c]$, where $p$ and $c$ are the parent and child positions.

%   Available:      cde gh jk m opq stuvw yz
% proposal: (p, q) for final span edges, (s, t) for split points, (o) for external point
The notation for items is: $T[lrx \; pl \; pr \; px]$

\begin{itemize}
  \item $T$ is the type of item, with multiple letters indicating any one of those types are allowed.
  \item A $\cdotp$ is used to indicate where the external point is relative to the item's span (to the left or the right).
  \item A $\dotuline{\hspace{2mm}}$ indicates that an item has only one edge from the external point into the span, while $\uwave{\hspace{2mm}}$ indicates that there is more than one such edge.
  \item $l$, $r$, and $x$ are labels that indicate the position of the left end of the span, the right end, and the external point, respectively.
  \item $pl$, $pr$, and $px$ are expressions that indicate the parents of the left end of the span, the right end, and the external point.
  \item The parent expressions can be an explicit need for a link, either direct, indirect, or none, \myeg $I$, $i$, and $F$.
  They can also be the complement of such an expression, \myeg $\overline{I}$, or if they can be any value a $.$ is used.
\end{itemize}

Note, since we are considering graphs, two points could be linked both directly and indirectly.
We track parent information to know about parents of items, and existence of specific edges.
As a result, if both an indirect link and a direct link are present, the state records a direct link being present.

\subsection{\textcite{eisner:1996}'s algorithm}

This work and \textcite{ec}'s algorithm both extend upon the ideas first described by \textcite{eisner:1996}.
Eisner's algorithm is an $O(n^3)$ dynamic program for projective dependency tree parsing.
If the reader is familiar with Eisner's algorithm, then this definition of it using our notation may help build intuition for our algorithm:

\begin{figure}[H]
\zerodisplayskips
\begin{subfigure}[t]{0.41\linewidth}
  \subcaption*{\normalsize Arc creation rules:}
  \scalebox{0.8}{
    \begin{minipage}[c]{0.15\linewidth}
      \begin{align*}
      & \begin{array}{l}
        I[pq \; F \; P] \leftarrow \max \\
        \;\;\; A[p \; q] \quad I[pq \; F \; \onlygraphs{F}] \\
      \end{array}
      \end{align*}
    \end{minipage}
  }
  \begin{minipage}[c]{0.25\linewidth}
    \begin{tikzpicture}
      \node (p) at (0, 0) {\footnotesize \strut $p$};
      \node (q) at (1.5, 0) {\footnotesize \strut $q$};
      \draw (0,0.2) -- (1.5,0.2);
      \draw [out=45,in=135,->,thin,>=Stealth] (p.north) to (q.north);
    \end{tikzpicture}
  \end{minipage}

  \vspace{5mm}
  \scalebox{0.8}{
    \begin{minipage}[c]{0.15\linewidth}
      \begin{align*}
      & \begin{array}{l}
        I[pq \; Q \; F] \leftarrow \max \\
        \;\;\; A[q \; p] \quad I[pq \; \onlygraphs{F} \; F] \\
      \end{array}
      \end{align*}
    \end{minipage}
  }
  \begin{minipage}[c]{0.25\linewidth}
    \begin{tikzpicture}
      \node (p) at (0, 0) {\footnotesize \strut $p$};
      \node (q) at (1.5, 0) {\footnotesize \strut $q$};
      \draw (0,0.2) -- (1.5,0.2);
      \draw [out=45,in=135,<-,thin,>=Stealth] (p.north) to (q.north);
    \end{tikzpicture}
  \end{minipage}
\end{subfigure}
\begin{subfigure}[t]{0.55\linewidth}
  \subcaption*{\normalsize Binary composition rules:}
  \scalebox{0.8}{
    \begin{minipage}[t]{0.2\linewidth}
      \begin{align*}
      & \begin{array}{l}
        I[pq \; F \; F] \leftarrow \max
      \end{array} \\
      & \left\{
        \begin{array}{l}
          \begin{array}{l}
            I[p \; p{+}1 \; F \; F] \quad I[p{+}1 \; q \; \overline{F} \; F] \\
          \end{array} \\
          \\
          \\
          \max_{s \in (p, q)} \\
          \left\{
            \begin{array}{l}
              I[ps \; F \; P] \quad I[sq \; \onlygraphs{F} \; F] \\
            \end{array}
          \right. \\
        \end{array}
      \right.
      \end{align*}
    \end{minipage}
  }
  \begin{minipage}[t]{0.34\linewidth}
    \vspace{5mm}
    \begin{tikzpicture}
      \node (hlref) at (0, 0) {};
      \node (hmref) at (1, 0) {};
      \node (hrref) at (3, 0) {};

      \node (p0) at (hlref) {};
      \node (s0a) at (hmref) {};
      \node (v0bref) [below=1ex of p0.center] {};
      \node (s0b) at (v0bref -| hmref) {};
      \node (q0) at (v0bref -| hrref) {};
      \draw (p0.center) -- (s0a.center);
      \draw (s0b.center) -- (q0.center);

      \node (lb) at (v0bref -| hlref) {};
      \node (sb) at (v0bref -| hmref) {};
      \node (rb) at (v0bref -| hrref) {};
      \node (ltext) [below=-0.5ex of lb.center] {\small \strut $p$};
      \node (stext) [below=-0.5ex of sb.center] {\small \strut ${p+1}$};
      \node (rtext) [below=-0.5ex of rb.center] {\small \strut $q$};
      \node (halfa) at ($(s0b)!0.5!(q0)$) {};
      \node (half) [above=3pt of halfa.center] {};
      \draw [dashed,out=180,in=45,->,thin,>=Stealth] (half) to (s0b.center);

      \node (hlrefL) at (0, -1.8) {};
      \node (hmrefL) at (1.5, -1.8) {};
      \node (hrrefL) at (3, -1.8) {};

      \node (p0L) at (hlrefL) {};
      \node (s0aL) at (hmrefL) {};
      \node (v0brefL) [below=1ex of p0L.center] {};
      \node (s0bL) at (v0brefL -| hmrefL) {};
      \node (q0L) at (v0brefL -| hrrefL) {};
      \draw (p0L.center) -- (s0aL.center);
      \draw (s0bL.center) -- (q0L.center);

      \node (lbL) at (v0brefL -| hlrefL) {};
      \node (sbL) at (v0brefL -| hmrefL) {};
      \node (rbL) at (v0brefL -| hrrefL) {};
      \node (ltextL) [below=-0.5ex of lbL.center] {\small \strut $p$};
      \node (stextL) [below=-0.5ex of sbL.center] {\small \strut ${s}$};
      \node (rtextL) [below=-0.5ex of rbL.center] {\small \strut $q$};
      \draw [out=45,in=135,->,thin,>=Stealth] (p0L.center) to (s0aL.center);
    \end{tikzpicture}
  \end{minipage}

  \scalebox{0.8}{
    \begin{minipage}[b]{0.2\linewidth}
      \begin{align*}
      & \begin{array}{l}
        I[pq \; F \; p] \leftarrow \max_{s \in (p, q)} \\
        \;\;\; I[ps \; F \; P] \quad I[sq \; F \; \overline{F}] \\
      \end{array}
      \end{align*}
    \end{minipage}
  }
  \begin{minipage}[c]{0.4\linewidth}
    \vspace{2mm}
    \begin{tikzpicture}
      \node (hlref) at (0, 0) {};
      \node (hmref) at (1.5, 0) {};
      \node (hrref) at (3, 0) {};

      \node (p0) at (hlref) {};
      \node (s0a) at (hmref) {};
      \node (v0bref) [below=1ex of p0.center] {};
      \node (s0b) at (v0bref -| hmref) {};
      \node (q0) at (v0bref -| hrref) {};
      \draw (p0.center) -- (s0a.center);
      \draw (s0b.center) -- (q0.center);

      \node (lb) at (v0bref -| hlref) {};
      \node (sb) at (v0bref -| hmref) {};
      \node (rb) at (v0bref -| hrref) {};
      \node (ltext) [below=-0.5ex of lb.center] {\small \strut $p$};
      \node (stext) [below=-0.5ex of sb.center] {\small \strut ${s}$};
      \node (rtext) [below=-0.5ex of rb.center] {\small \strut $q$};
      \draw [out=45,in=135,->,thin,>=Stealth] (p0.center) to (s0a.center);
      \node (halfa) at ($(s0b)!0.5!(q0)$) {};
      \node (half) [above=3pt of halfa.center] {};
      \draw [dashed,out=0,in=135,->,thin,>=Stealth] (half) to (q0.center);
    \end{tikzpicture}
  \end{minipage}

  \scalebox{0.8}{
    \begin{minipage}[b]{0.2\linewidth}
      \begin{align*}
      & \begin{array}{l}
        I[pq \; q \; F] \leftarrow \max_{s \in (p, q)} \\
        \;\;\; I[ps \; \overline{F} \; F] \quad I[sq \; Q \; F] \\
      \end{array}
      \end{align*}
    \end{minipage}
  }
  \begin{minipage}[c]{0.4\linewidth}
    \vspace{2mm}
    \begin{tikzpicture}
      \node (hlref) at (0, 0) {};
      \node (hmref) at (1.5, 0) {};
      \node (hrref) at (3, 0) {};

      \node (p0) at (hlref) {};
      \node (s0a) at (hmref) {};
      \node (v0bref) [below=1ex of p0.center] {};
      \node (s0b) at (v0bref -| hmref) {};
      \node (q0) at (v0bref -| hrref) {};
      \draw (p0.center) -- (s0a.center);
      \draw (s0b.center) -- (q0.center);

      \node (lb) at (v0bref -| hlref) {};
      \node (sb) at (v0bref -| hmref) {};
      \node (rb) at (v0bref -| hrref) {};
      \node (ltext) [below=-0.5ex of lb.center] {\small \strut $p$};
      \node (stext) [below=-0.5ex of sb.center] {\small \strut ${s}$};
      \node (rtext) [below=-0.5ex of rb.center] {\small \strut $q$};
      \node (halfa) at ($(p0)!0.5!(s0a)$) {};
      \node (half) [above=3pt of halfa.center] {};
      \draw [dashed,out=45,in=180,<-,thin,>=Stealth] (p0.center) to (half);
      \draw [out=45,in=135,<-,thin,>=Stealth] (s0b.center) to (q0.center);
    \end{tikzpicture}
  \end{minipage}
\end{subfigure}
\end{figure}

To be specific, this is a version of the algorithm in which the structure is built from the outside in\footnote{
Alternatives are from the inside out, always left to right, or always right to left.
}, and where arc creation is separated out into an independent step\footnote{
Arc creation could be combined into the binary step, though for a first-order model there should be an independent search for the best arc over each span, so that complexity is $O(n^3 + an^2)$ rather than $O(an^3)$, where $a$ is the number of arc types.
}.
A projective graph parsing algorithm can be formed by changing the boxed blue parts to be $\textcolor{blue}{\overline{P}}$ (upper left), $\textcolor{blue}{\overline{Q}}$ (lower left), and \scalebox{2.0}{$\textcolor{blue}{.}$} (right).
These rules are all present in our algorithm as well, they correspond to the rules that only use intervals.

Eisner's algorithm has been formulated in several different ways that share the same core idea, but structure the deduction rules slightly differently.
One well-known formulation of was presented by \textcite{eisner-smith-2005}.
Their items are slightly different, with their triangle items going from on one word to between two words (whereas ours are always from on one word to on another word).
However, we can roughly relate the inference rules as follows, where some of our rules take place in two steps in their rules:

\begin{center}
\begin{tabular}{ll}
  \raisebox{-3pt}{
  \begin{tikzpicture}
    \draw (0,0) -- (0,0.6) -- (0.4,0.4) -- (0.4,0) -- cycle;
  \end{tikzpicture}
  }
  $+$
  \raisebox{-3pt}{
  \begin{tikzpicture}
    \draw (0,0) -- (0,0.4) -- (0.4,0) -- cycle;
  \end{tikzpicture}
  }
  & \parbox{0.5\linewidth}{corresponds to the third binary rule, or one step of the second binary rule.}
  \\[10pt]
  \raisebox{-3pt}{
  \begin{tikzpicture}
    \draw (0,0) -- (0.4,0) -- (0.4,0.4) -- cycle;
  \end{tikzpicture}
  }
  $+$
  \raisebox{-3pt}{
  \begin{tikzpicture}
    \draw (0,0) -- (0,0.4) -- (0.4,0.6) -- (0.4,0) -- cycle;
  \end{tikzpicture}
  }
  & \parbox{0.5\linewidth}{corresponds to the fourth binary rule, or one step of the first binary rule.}
  \\[10pt]
  \raisebox{-3pt}{
  \begin{tikzpicture}
    \draw (0,0) -- (0,0.4) -- (0.4,0) -- cycle;
  \end{tikzpicture}
  }
  $+$
  \raisebox{-3pt}{
  \begin{tikzpicture}
    \draw (0,0) -- (0.4,0) -- (0.4,0.4) -- cycle;
  \end{tikzpicture}
  }
  & \parbox{0.5\linewidth}{corresponds to the second step of the first two binary rules, plus either of the arc creation rules.}
  \\
\end{tabular}
\end{center}

Another connection to make at this point is with the CFG version of Eisner's algorithm, presented by \textcite{P07-1022}.
It is probably not possible to perform a similar transofmration on the algorithm we propose, though in Section~\ref{sec:impl} we discuss similar challenges in terms of correctly computing inside and outside scores as are raised in Section 4 of \textcite{P07-1022}.

\subsection{Initialization}

To start, an item is added for every position $p$ in the sentence, except the last one. The items are:

\finalequation{
  $I[p \; p{+}1 \; F \; F]$
}

If any type of word label is being used, an item must be inserted for every pair of possible labels.

\subsection{Interval}
The first way we subdivide into cases is based on whether there is a direct edge linking the two ends of the item.

\subsubsection{Direct Edges Present}

\begin{center}
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (q) at (4, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (q.north);
\end{tikzpicture}
\end{center}

This covers two possible structures, one with the edge going from $p$ to $q$ and one with the edge going from $q$ to $p$.
In both cases, the other end must have a parent state of $F$, as otherwise we would have a directed cycle.
We can break these cases down into the edge, plus the item beneath it:

\finalequation{
  $I[pq \; F \; P] \leftarrow \max A[p \; q] \quad I[pq \; F \; \overline{P}]$ \\
  $I[pq \; Q \; F] \leftarrow \max A[q \; p] \quad I[pq \; \overline{Q} \; F]$
}

If we were only considering trees then we would constrain the sub-item to be $I[pq \; F \; F]$.

\subsubsection{No Direct Edges Present}

First consider the case when $p$ does not have a parent in this item (the case when it does is symmetrical to the case when $q$ has a parent, which is covered by this case).

If there are no $p$--$(pq)$ edges, then this can be broken into two intervals, splitting at $p+1$.
The second item has an $\overline{F}$ because $p+1$ must get a parent from somewhere.

\finalequation{
  $I[p \; p{+}1 \; F \; F] \quad I[p{+}1 \; q \; \overline{F} \; F]$
}

If $p$--$(pq)$ edges do exist, consider the longest such edge, $ps$.
Consider the set $C$, of edges that cross $ps$.
Depending on the size of the set $C$ we get different decompositions.

\begin{center}
\begin{tikzpicture}
  \node (case) at (-0.5, 0.4) {$|C| = 0$};
  \node (p) at (1, 0) {\strut $p$};
  \node (ps) at (2, 0) {\strut};
  \node (s) at (3, 0) {\strut $s$};
  \node (sq) at (4, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,not allowed] (ps.north) to (sq.north);
\end{tikzpicture}
\end{center}

In this case there are no $p$--$(sq]$ edges, because of how $s$ was chosen.
There are no $(ps)$--$(sq]$ edges, because in this case $|C| = 0$.
Therefore we can break this case down into two intervals.
The left interval contains a direct edge from the left end to the right end.
The right interval can have a range of options for parent sets, which we leave undefined in the template, to be constrained later using the general rules.

\finalequation{
  $I[ps \; F \; P] \quad I[sq \; . \; .]$
}

\begin{center}
\begin{tikzpicture}
  \node (case) at (-0.5, 0.4) {$|C| = 1$};
  \node (p) at (1, 0) {\strut $p$};
  \node (ps) at (2, 0) {\strut};
  \node (s) at (3, 0) {\strut $s$};
  \node (t) at (4, 0) {\strut $t$};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,required undirected] (ps.north) to (t.north);
\end{tikzpicture}
\end{center}

Here we have made a choice, placing $t$ outside of $ps$.
Placing it inside would also lead to a valid set of deduction rules, but allowing both creates an ambiguity.

In this case there are no $(ps)$--$(st)$ edges by construction, and there are no $(st)$--$(tq]$ edges, as they would violate the \oneEC property for the edge ending at $t$.
We subdivide this into two cases, depending on whether there is an $s$--$(tq)$ edge.

\begin{center}
\begin{tikzpicture}
  \node [text width=3cm] (case) at (-0.5, 0.4) {$|C| = 1$ \\ Edge present};
  \node (p) at (1, 0) {\strut $p$};
  \node (ps) at (2, 0) {\strut};
  \node (s) at (3, 0) {\strut $s$};
  \node (t) at (4, 0) {\strut $t$};
  \node (tq) at (4.5, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,required undirected] (ps.north) to (t.north);
  \draw [out=45,in=135,required undirected] (s.north) to (tq.north);
\end{tikzpicture}
\end{center}

In this case we have an item $[ps.t]$, because $|C| = 1$ means there are no further $[ps)$--$(sq)$ edges.
The edge with an endpoint at $t$ could be crossed by an $s$--$(ps)$ edge, but not by a $p$--$(ps)$ edge, as that would violate the \oneEC property.
This means $[ps.t]$ is either an $N$ or and $R$, and in either case will have the edge $ps$.

We also have an interval, $[st]$, because any $(st)$--$(tq)$ edges would violate the \oneEC property for the edge with an endpoint at $t$, and there are no $(st)$--$(ps)$ edges by construction.

The third item is $[tq.s]$, for reasons already given (in terms of what edges are allowed).
This cannot be an $R$ or $B$ because that would violate the \oneEC property for the $s$--$(tq)$ edge.
If there is only one $s$--$(tq]$ edge, and it is $sq$, then this item is an $X$.
Otherwise it will be either an $L$ or $N$, depending on whether the $s$--$(tq)$ edge is crossed by a $t$--$(tq)$ edge.
If $st$ or $ts$ exists, we attribute it to the middle sub-item (it could come from any of them, so this avoids a spurious ambiguity).

\finalequation{
  $RN\cdotp [pst \; F \; P\overline{T} \; \overline{PS}] \quad I[st \; . \; .] \quad \cdotp LNX[tqs \; .\overline{S} \; . \; \overline{T}.]$
}

\begin{center}
\begin{tikzpicture}
  \node [text width=3cm] (case) at (-0.5, 0.4) {$|C| = 1$ \\ No edge};
  \node (p) at (1, 0) {\strut $p$};
  \node (ps) at (2, 0) {\strut};
  \node (s) at (3, 0) {\strut $s$};
  \node (t) at (4, 0) {\strut $t$};
  \node (tq) at (4.5, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,required undirected] (ps.north) to (t.north);
  \draw [out=45,in=135,not allowed] (s.north) to (tq.north);
\end{tikzpicture}
\end{center}

By the same argument as above, we have an item $[ps.t]$, and no $(st)$--$(tq)$ edges.
Since we don't have any $s$--$(tq)$ edges, the third item is now an interval, $[tq]$.
$[st]$ is still an interval, by the same argument as above.
The first item is less restricted than before, it could be am $L$, $R$, or $N$.
It cannot be a $B$ because there is only one $(ps)$--$t$ edge.
In this case it's also possible that $t = q$, in which case there is no third item (it would have width 0).

\finalequation{
  $LRN\cdotp [pst \; F \; P\overline{T} \; \overline{PS}] \quad I[st \; . \; .] \quad I[tq \; . \; .]$ \\
  $LRN\cdotp [psq \; F \; P\overline{Q} \; \overline{PS}] \quad I[sq \; . \; .]$ \\
}

\begin{center}
\begin{tikzpicture}
  \node [text width=3cm] (case) at (-0.5, 0.4) {$|C| > 1$ \\ Outside};
  \node (p) at (1, 0) {\strut $p$};
  \node (ps) at (2, 0) {\strut};
  \node (ps2) at (2.5, 0) {\strut};
  \node (s) at (3, 0) {\strut $s$};
  \node (t) at (4, 0) {\strut $t$};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,required undirected] (ps.north) to (t.north);
  \draw [out=45,in=135,required undirected] (ps2.north) to (t.north);
\end{tikzpicture}
\end{center}

This is the first of two cases where $|C| > 1$, distinguished by the position of $t$, either inside or outside of $ps$.
The same arguments given above apply here, giving the same derivation, the only differences is that $[ps.t]$ must contain at least two $t$--$(ps)$ edges, and as a result the left item could be a $B$ now.

\finalequation{
  $RN\cdotp [pst \; F \; P\overline{T} \; \overline{PS}] \quad I[st \; . \; .] \quad \cdotp LNX[tqs \; .\overline{S} \; . \; \overline{T}.]$ \\
  $BLRN\cdotp [pst \; F \; P\overline{T} \; \overline{PS}] \quad I[st \; . \; .] \quad I[tq \; . \; .]$ \\
  $BLRN\cdotp [psq \; F \; P\overline{Q} \; \overline{PS}] \quad I[sq \; . \; .]$ \\
}

\begin{center}
\begin{tikzpicture}
  \node [text width=3cm] (case) at (-0.5, 0.4) {$|C| > 1$ \\ Inside};
  \node (p) at (1, 0) {\strut $p$};
  \node (t) at (2, 0) {\strut $t$};
  \node (s) at (3, 0) {\strut $s$};
  \node (sq) at (3.5, 0) {\strut};
  \node (sq2) at (4, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,required undirected] (t.north) to (sq.north);
  \draw [out=45,in=135,required undirected] (t.north) to (sq2.north);
\end{tikzpicture}
\end{center}

In this case there are no $(pt)$--$(ts)$ edges, as they would violate the \oneEC property for the edges in $C$.
There are also no $(pt)$--$(sq)$ edges, as they would violate the \oneEC property for $ps$.
As in the previous case there are two decomposition options, this time depending on whether there is a $p$--$(ts)$ edge.

\begin{center}
\begin{tikzpicture}
  \node [text width=3cm] (case) at (-0.5, 0.4) {$|C| > 1$ \\ Inside \\ Edge present};
  \node (p) at (1, 0) {\strut $p$};
  \node (t) at (2, 0) {\strut $t$};
  \node (ts) at (2.5, 0) {\strut};
  \node (s) at (3, 0) {\strut $s$};
  \node (sq) at (3.5, 0) {\strut};
  \node (sq2) at (4, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,required directed] (p.north) to (ts.north);
  \draw [out=45,in=135,required undirected] (t.north) to (sq.north);
  \draw [out=45,in=135,required undirected] (t.north) to (sq2.north);
\end{tikzpicture}
\end{center}

In this case there are no $(pt)$--$(ts]$ edges, or between $(ts)$ and $(sq]$, because they would violate the \oneEC property for the edges in $C$.
There are also no $(pt)$--$[sq]$ edges, because they would violate the \oneEC property for the $p$--$(ts)$ edges.
There are no $p$--$(sq]$ edges by construction.
This means the left item is $[pt]$, the middle item is $[ts.p]$, and the right item is $[sq.t]$.
The left item is an $I$.
The middle item can be an $L$ or $N$, but an $R$ would violate the \oneEC property for the $p$--$(ts)$ edge.
The right item must be an $N$ with multiple edges from the external point to the interior of the span.
Any other option would violate the \oneEC property for edges in $C$.

Additional constraints are added to ensure direct $st$ and $pt$ edges can only occur in one of the items.
Also, $sq$ cannot occur, as it would violate the \oneEC property for edges in $C$.

\finalequation{
  $I[pt \; F \; .] \quad \cdotp LN[tsp \; .\overline{P} \; .P \; F] \quad \cdotp \uwave{N}[sqt \; \overline{QT} \; \overline{S}. \; \overline{S}.]$
}

\begin{center}
\begin{tikzpicture}
  \node [text width=3cm] (case) at (-0.5, 0.4) {$|C| > 1$ \\ Inside \\ No edge};
  \node (p) at (1, 0) {\strut $p$};
  \node (t) at (2, 0) {\strut $t$};
  \node (ts) at (2.5, 0) {\strut};
  \node (s) at (3, 0) {\strut $s$};
  \node (sq) at (3.5, 0) {\strut};
  \node (sq2) at (4, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,required directed] (p.north) to (s.north);
  \draw [out=45,in=135,not allowed] (p.north) to (ts.north);
  \draw [out=45,in=135,required undirected] (t.north) to (sq.north);
  \draw [out=45,in=135,required undirected] (t.north) to (sq2.north);
\end{tikzpicture}
\end{center}

This case is similar to the case above, with most of the argument still holding.
The difference is that with the constraint of no edges as shown, $[ts]$ is an $I$.
Meanwhile, there can be $s$--$(pt)$ edges.
Again, we add extra constraints to ensure the direct $ts$ edge can only occur in one item.

\finalequation{
  $RNX\cdotp [pts \; F \; .\overline{S} \; P\overline{T}] \quad I[ts \; . \; .] \quad \cdotp \uwave{LN}[sqt \; .\overline{T} \; . \; \overline{S}.]$
}

\subsection{Exterval}
In this case we simply need to remove the edge from $o$ to the span and we will have an interval.
Let the external point be to the right of the span (having it on the left is symmetrical).
The two general structures are as follows, with the dashed lines indicating that a $pq$ edge may or may not be present, and the small square indicating the external point:

\begin{center}
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (q) at (3, 0) {\strut $q$};
  \node (o) at (5, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,dashed] (p.north) to (q.north);
  \draw [out=45,in=135] (p.north) to (o.north);
\end{tikzpicture}
\\
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (q) at (3, 0) {\strut $q$};
  \node (o) at (5, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,dashed] (p.north) to (q.north);
  \draw [out=45,in=135] (q.north) to (o.north);
\end{tikzpicture}
\end{center}

The way the other deduction rules are structured, we never encounter the case where both of the solid edges are present.
We always remove the solid edges first, leaving the dashed edge (if present) for the interval decomposition.
Since this is the only edge with an endpoint at $O$ we also know there are no indirect connections between $o$ and $p$ or $q$.
There are four possibilities in total, depending on which direction the edge goes in:

\finalequation{
  $X[pqo \; .O \; .\overline{O} \; F] \leftarrow \max A[o \; p] \quad I[pq \; . \; .]$ \\
  $X[pqo \; .\overline{O} \; .\overline{O} \; P\overline{Q}] \leftarrow \max  A[p \; o] \quad I[pq \; . \; .]$ \\
  $X[pqo \; .\overline{O} \; .O \; F] \leftarrow \max A[o \; q] \quad I[pq \; . \; .]$ \\
  $X[pqo \; .\overline{O} \; .\overline{O} \; \overline{P}Q] \leftarrow \max A[q \; o] \quad I[pq \; . \; .]$ \\
}

\subsection{Both}
The way we decomposed the Interval case has implications for the range of possible Both structures.
Specifically, it can only come up in two ways:

\finalequation{
  $B\cdotp [psq \; F \; P\overline{Q} \; \overline{PS}]$ \\
  $\cdotp B[pqo \; Q\overline{O} \; F \; \overline{PQ}]$
}

The $B$ item is not involved in any further decompositions, so these are the only cases we need to consider.
As in the Interval case, we start by separating out cases with direct edges and those without.

\subsubsection{Direct Edges Present}
In this case we have these two structures, with all the edges shown required because of the definition of a $B$ item:

\begin{center}
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (p2) at (2, 0) {\strut};
  \node (sp) at (2.5, 0) {\strut};
  \node (sq) at (3.5, 0) {\strut};
  \node (q2) at (4, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=135,in=45,required directed] (q.north) to (p.north);
  \draw [out=25,in=155] (p.north) to (sp.north);
  \draw [out=25,in=155] (sq.north) to (q.north);
  \draw [out=25,in=155] (p2.north) to (o.north);
  \draw [out=25,in=155] (q2.north) to (o.north);
\end{tikzpicture}
\\
\begin{tikzpicture}
  \node (o) at (1, 0) {\strut $o$};
  \node (p) at (2, 0) {\strut $p$};
  \node (p2) at (3, 0) {\strut};
  \node (sp) at (3.5, 0) {\strut};
  \node (sq) at (4.5, 0) {\strut};
  \node (q2) at (5, 0) {\strut};
  \node (q) at (6, 0) {\strut $q$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=35,in=145,required directed] (p.north) to (q.north);
  \draw [out=25,in=155] (p.north) to (sp.north);
  \draw [out=25,in=155] (sq.north) to (q.north);
  \draw [out=155,in=25] (q2.north) to (o.north);
  \draw [out=155,in=25] (p2.north) to (o.north);
\end{tikzpicture}
\end{center}

In each case we remove the $p$--$q$ edge.

\finalequation{
  $B\cdotp [pqo \; F \; P\overline{O} \; \overline{PQ}] \leftarrow \max A[p \; q] \quad B\cdotp [pqo \; F \; \overline{PO} \; \overline{PQ}]$ \\
  $\cdotp B[pqo \; Q\overline{O} \; F \; \overline{PQ}] \leftarrow \max A[q \; p] \quad \cdotp B[pqo \; \overline{QO} \; F \; \overline{PQ}]$
}

\subsubsection{No Direct Edges Present}
Consider the case when $o$ is to the right of the span (the case when $o$ is to the left of the span is symmetrical).
Consider the longest $p$--$(pq)$ edge.
There are two general cases, depending on whether this edge crosses any $q$--$(pq)$ edges.

\begin{center}
\begin{tikzpicture}
  \node (relation) at (0,0.5) {Crossing};
  \node (p) at (1, 0) {\strut $p$};
  \node (sq) at (2.5, 0) {\strut $s_q$};
  \node (sp) at (3.5, 0) {\strut $s_p$};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=25,in=155] (p.north) to (sp.north);
  \draw [out=25,in=155] (sq.north) to (q.north);
  \draw [out=25,in=155,dashed] (sq.north) to (o.north);
  \draw [out=25,in=155,dashed] (sp.north) to (o.north);
\end{tikzpicture}
\end{center}

The dashed edges must be present because this is a $B$.
They must end at $s_p$ and $s_q$ because otherwise they would violate the \oneEC property for either $ps_p$ or $qs_q$.
Once those edges are set, the \oneEC property blocks the following edge types:
$o$-$(pq)$,
$q$-$(ps_q)$,
$p$-$(s_pq)$,
$(ps_q)$-$(s_pq)$,
$[ps_q)$-$(s_qs_p)$,
$(s_qs_p)$-$(s_pq]$.
This means it can be decomposed into three items, $[ps_q.s_p]$, $[s_qs_p.o]$, $[s_pq.s_q]$.
The left of these cannot be an $L$, as that would violate \oneEC for $s_p$--$(ps_q)$ edges, but it can be an $R$ or $N$.
Similarly, the right item cannot be an $R$, but can be an $L$ or $N$.
The middle item would be an $X$, but with a modification to our definition to allow edges from both $s_p$ and $s_q$ to $o$.

\begin{center}
\begin{tikzpicture}
  \node (relation) at (-0.2,0.5) {No Crossing};
  \node (p) at (1, 0) {\strut $p$};
  \node (m0) at (1.5, 0) {\strut};
  \node (sp) at (2, 0) {\strut $s$};
  \node (sq) at (4, 0) {\strut};
  \node (m1) at (4.5, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (sp.north);
  \draw [out=45,in=135] (sq.north) to (q.north);
  \draw [out=25,in=155] (m0.north) to (o.north);
  \draw [out=25,in=155] (m1.north) to (o.north);
\end{tikzpicture}
\end{center}

The way we choose the split point in this case will mean we need to track an extra bit of information for $L$ items.
If no $(ps)$--$(sq)$ edge exists, then $s$ is the split point.
If an edge does exist, the \oneEC property will mean there is only one $o$--$(ps)$ edge and these two edges share an endpoint:

\begin{center}
\begin{tikzpicture}
  \node (relation) at (0,0.5) {};
  \node (p) at (1, 0) {\strut $p$};
  \node (m0) at (1.5, 0) {\strut};
  \node (sp) at (2, 0) {\strut};
  \node (m2) at (2.5, 0) {\strut $t$};
  \node (sq) at (4, 0) {\strut};
  \node (m1) at (4.5, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=55,in=125] (p.north) to (sp.north);
  \draw [out=55,in=125] (sq.north) to (q.north);
  \draw [out=35,in=145] (m0.north) to (o.north);
  \draw [out=35,in=145] (m0.north) to (m2.north);
  \draw [out=35,in=145] (m1.north) to (o.north);
\end{tikzpicture}
\end{center}

Again, there will be two possibilities, either there are no $(pt)$--$(tq)$ edges, in which case we use $t$ as the split point, or there are such edges, in which case the pattern continues:

\begin{center}
\begin{tikzpicture}
  \node (relation) at (0,0.5) {};
  \node (p) at (1, 0) {\strut $p$};
  \node (m0) at (1.5, 0) {\strut};
  \node (s) at (2, 0) {\strut};
  \node (m2) at (2.5, 0) {\strut};
  \node (m3) at (3, 0) {\strut $u$};
  \node (sq) at (4, 0) {\strut};
  \node (m1) at (4.5, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=55,in=125] (p.north) to (s.north);
  \draw [out=55,in=125] (sq.north) to (q.north);
  \draw [out=35,in=145] (m0.north) to (o.north);
  \draw [out=35,in=145] (m0.north) to (m2.north);
  \draw [out=35,in=145] (m1.north) to (o.north);
  \draw [out=35,in=145] (s.north) to (m3.north);
\end{tikzpicture}
\\
\begin{tikzpicture}
  \node (relation) at (0,0.5) {};
  \node (p) at (1, 0) {\strut $p$};
  \node (m0) at (1.5, 0) {\strut};
  \node (s) at (2, 0) {\strut};
  \node (m2) at (2.5, 0) {\strut};
  \node (m3) at (3, 0) {\strut};
  \node (m4) at (3.5, 0) {\strut $v$};
  \node (sq) at (4, 0) {\strut};
  \node (m1) at (4.5, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=55,in=125] (p.north) to (s.north);
  \draw [out=55,in=125] (sq.north) to (q.north);
  \draw [out=35,in=145] (m0.north) to (o.north);
  \draw [out=35,in=145] (m0.north) to (m2.north);
  \draw [out=35,in=145] (m1.north) to (o.north);
  \draw [out=35,in=145] (s.north) to (m3.north);
  \draw [out=35,in=145] (m2.north) to (m4.north);
\end{tikzpicture}
\end{center}

Eventually this chain of crossing edges will either stop in the middle, or cross the edge shown between $q$ and $(pq)$.
In the second case it must have the following structure, or otherwise it would have a \oneEC violation for reasons symmetrical to the constraints that started the chain:

\begin{center}
\begin{tikzpicture}
  \node (relation) at (0,0.5) {};
  \node (p) at (1, 0) {\strut $p$};
  \node (m0) at (1.5, 0) {\strut};
  \node (s) at (2, 0) {\strut};
  \node (m2) at (2.5, 0) {\strut};
  \node (m3) at (3, 0) {\strut};
  \node (m4) at (3.5, 0) {\strut};
  \node (sq) at (4, 0) {\strut};
  \node (m1) at (4.5, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw [out=55,in=125] (p.north) to (s.north);
  \draw [out=55,in=125] (sq.north) to (q.north);
  \draw [out=35,in=145] (m0.north) to (o.north);
  \draw [out=35,in=145] (m0.north) to (m2.north);
  \draw [out=35,in=145] (m1.north) to (o.north);
  \draw [out=35,in=145] (s.north) to (m3.north);
  \draw [out=35,in=145] (m4.north) to (m1.north);
  \draw [out=35,in=145] (m3.north) to (sq.north);
  \node [fill=white] (dots) at (3,0.5) {\small . . .};
  \draw (p.north) -- (q.north);
\end{tikzpicture}
\end{center}

In this final case, we cannot define a simple decomposition of the structure using the item types we consider.
By not covering this case we lose completeness for the space of one-endpoint-crossing graphs.
However, as in the problematic $O(n^5)$ case, this is rarely observed in the treebank.

Returning to the case where the chain of crossing edges ends earlier, we use that as the split point and have two items, $[ps.o]$ and $[sq.o]$.
The left item must have at least one crossing of an edge $o$-$(ps)$ and an edge $p$-$(ps)$, but there cannot be a crossing between $o$-$(ps)$ and any edge $(ps)$-$(ps)$ as that would violate the definition of a $B$.
Therefore the left item is either an $L$ or an $N$ with an edge $ps$.
Similarly, the right item is either an $N$ with an edge $sq$, or an $R$.
In order to avoid a spurious ambiguity, we also need to ensure that the left item has the chaining property discussed above.
If the left item is an $N$, it does, as the edge $ps$ provides a suitable split point.
For an $L$ we need to track whether the property is true or not.
In practice we avoid the chaining pattern entirely, using the constraint that $L$ must also contain the edge $ps$, with no loss in coverage.
How to track the chaining property is discussed below for completeness.

\finalequation{
  $B\cdotp [pqo \; F \; \overline{PO} \; \overline{PQ}] \leftarrow \max_{s \in (p, q)}$\mbox{\hspace{2.5cm}} \\
  $LN\cdotp [pso \; F \; P\overline{O} \; \overline{PS}] \quad R\cdotp [sqo \; . \; .\overline{O} \; .\overline{Q}]$ \\
  $LN\cdotp [pso \; F \; P\overline{O} \; \overline{PS}] \quad N\cdotp [sqo \; \overline{Q}. \; S\overline{O} \; .\overline{Q}]$ \\
  $LN\cdotp [pso \; F \; P\overline{O} \; \overline{PS}] \quad N\cdotp [sqo \; Q. \; \overline{SO} \; .\overline{Q}]$ \\[4pt]

  $\cdotp B[pqo \; \overline{QO} \; F \; \overline{PQ}] \leftarrow \max_{s \in (p, q)}$\mbox{\hspace{2.5cm}} \\
  $\cdotp L[pso \; .\overline{O} \; . \; \overline{P}.] \quad \cdotp RN[sqo \; Q\overline{O} \; F \; \overline{SQ}]$ \\
  $\cdotp N[pso \; S\overline{O} \; \overline{P}. \; \overline{P}.] \quad \cdotp RN[sqo \; Q\overline{O} \; F \; \overline{SQ}]$ \\
  $\cdotp N[pso \; \overline{SO} \; P. \; \overline{P}.] \quad \cdotp RN[sqo \; Q\overline{O} \; F \; \overline{SQ}]$
}

\subsection{Left}
The other decompositions, and the way we will structure this one, enable us to constrain the possible direct edges for $L$ items.
Specifically, there is never a $po$ edge.
To make this the case there will be instances later in this section where the decomposition provides a choice where an edge could come from one of two sub-items.
We will make that choice to ensure this property (no $po$ edges) remains true.

\begin{center}
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (m) at (2, 0) {\strut};
  \node (s) at (3, 0) {\strut};
  \node (q) at (4, 0) {\strut $q$};
  \node (o) at (5, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,dashed] (p.north) to (q.north);
  \draw [out=45,in=135] (q.north) to (o.north);
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (m.north) to (o.north);
\end{tikzpicture}
\end{center}

First we have a rule to remove the $qo$ edge.
For $L$ items we also have to track whether there are multiple $o$--$(pq)$ edges.
Adding this edge guarantees that there are multiple such edges.

\finalequation{
  $\uwave{L}[pqo \; .\overline{O} \; .O \; \overline{PQ}] \leftarrow \max A[o \; q] \quad L[pqo \; .\overline{O} \; .\overline{O} \; \overline{PQ}]$ \\
  $\uwave{L}[pqo \; .\overline{O} \; .\overline{O} \; \overline{P}Q] \leftarrow \max A[q \; o] \quad L[pqo \; .\overline{O} \; .\overline{O} \; \overline{PQ}]$
}

Once that edge is removed we are either left with an $L$ that has no direct edges, or one with the dashed edge above.
Next are rules to remove that edge:

\finalequation{
  $L[pqo \; Q\overline{O} \; \overline{PO} \; \overline{PQ}] \leftarrow \max A[q \; p] \quad L[pqo \; \overline{QO} \; \overline{PO} \; \overline{PQ}]$ \\
  $L[pqo \; \overline{QO} \; P\overline{O} \; \overline{PQ}] \leftarrow \max A[p \; q] \quad L[pqo \; \overline{QO} \; \overline{PO} \; \overline{PQ}]$
}

Now we are considering an $L$ with no direct edges (as indicated by the red dotted lines):

\begin{center}
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (m) at (2, 0) {\strut};
  \node (s) at (3, 0) {\strut};
  \node (q) at (4, 0) {\strut $q$};
  \node (o) at (5, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,not allowed] (p.north) to (q.north);
  \draw [out=45,in=135,not allowed] (p.north) to (o.north);
  \draw [out=45,in=135,not allowed] (q.north) to (o.north);
  \draw [out=45,in=135,not allowed] (q.north) to (o.north);
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (m.north) to (o.north);
\end{tikzpicture}
\end{center}

We will be dividing it into two pieces.
To determine the split point, consider the $o$--$(pq)$ edges.
For these edges, let $s$ be the endpoint furthest from $p$.
Using this definition we have that there are no edges $o$--$(sq]$, 
There are also no edges $(ps)$--$(sq)$ by the definition of $L$.
Therefore we can divide the item into $[ps.o]$ and $[sq.p]$.
To determine the type of these two regions, consider whether or not $os$ is crossed.

\begin{center}
\begin{tikzpicture}
  \node [text width=2cm] (relation) at (0,0.5) {Not \\ Crossed};
  \node (p) at (1, 0) {\strut $p$};
  \node (m) at (2, 0) {\strut};
  \node (s) at (3, 0) {\strut};
  \node (m2) at (3.5, 0) {\strut $s$};
  \node (q) at (4, 0) {\strut $q$};
  \node (o) at (5, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (m.north) to (o.north);
  \draw [out=45,in=135] (m2.north) to (o.north);
\end{tikzpicture}
\end{center}

By construction, there are no $[ps)$--$(sq]$ edges, and so $[sq.p]$ is actually the interval $[sq]$.
For the left part of the item, consider whether there is a crossing between $p$--$(ps)$ edges and $o$--$(ps)$ edges.
If such a crossing exists, $[ps.o]$ is an $L$.
Otherwise, it is an $N$.
The $N$ case occurs when the only edge crossing the $o$--$(pq)$ edges is an edge $ps$, which ends inside $(pq)$, making the complete item an $L$, but does not once we split at $s$.

\finalequation{
  $L[pso \; .\overline{O} \; .O \; \overline{PS}] \quad I[sq \; . \; .]$ \\
  $L[pso \; .\overline{O} \; .\overline{O} \; \overline{P}S] \quad I[sq \; . \; .]$ \\
  $N[pso \; \overline{SO} \; PO \; \overline{PS}] \quad I[sq \; . \; .]$ \\
  $N[pso \; \overline{SO} \; P\overline{O} \; \overline{P}S] \quad I[sq \; . \; .]$ \\
  $N[pso \; S\overline{O} \; \overline{P}O \; \overline{PS}] \quad I[sq \; . \; .]$ \\
  $N[pso \; S\overline{O} \; \overline{PO} \; \overline{P}S] \quad I[sq \; . \; .]$
}

\begin{center}
\begin{tikzpicture}
  \node [text width=2cm] (relation) at (0,0.5) {Single \\ Crossing};
  \node (p) at (1, 0) {\strut $p$};
  \node (m) at (2, 0) {\strut $s$};
  \node (s) at (3, 0) {\strut};
  \node (q) at (4, 0) {\strut $q$};
  \node (o) at (5, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (m.north) to (o.north);
\end{tikzpicture}
\end{center}

Consider the case when $os$ is the only $o$--$(pq)$ edge.
Here, the first sub-item is an $X$, $[ps.o]$.
For the second sub-item, all $p$--$(s, q]$ edges will be crossed by $os$ and so cannot be crossed by $q$--$(sq)$ edges.
If there is an $s$--$(sq)$ edge that crosses an $p$--$(sq)$ edge then this sub-item is an $L$, otherwise it is an $N$.
Also, the item being split in this case can be marked as containing only one edge from the external point into the span.

\finalequation{
  $X[pso \; .\overline{O} \; .O \; F] \quad \cdotp LN[sqp \; .\overline{P} \; .\overline{P} \; \overline{SQ}]$ \\
  $X[pso \; .\overline{O} \; .\overline{O} \; \overline{P}S] \quad \cdotp LN[sqp \; .\overline{P} \; .\overline{P} \; \overline{SQ}] $\\
}

\begin{center}
\begin{tikzpicture}
  \node (relation) at (0,0.5) {Multiple};
  \node (p) at (1, 0) {\strut $p$};
  \node (m2) at (1.5, 0) {\strut};
  \node (m) at (2, 0) {\strut $s$};
  \node (s) at (3, 0) {\strut};
  \node (q) at (4, 0) {\strut $q$};
  \node (o) at (5, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (p.north) to (s.north);
  \draw [out=45,in=135] (m.north) to (o.north);
  \draw [out=45,in=135] (m2.north) to (o.north);
\end{tikzpicture}
\end{center}

Consider the case when $os$ is not the only $o$--$(pq)$ edge.
If there is an $o$--$(ps)$ edge that is crossed by a $p$--$(ps)$ edge then $ps.o$ is an $L$.
Otherwise, $[ps.o]$ is an $N$.
For the second half, all $p$--$(sq)$ edges are going to cross two or more $o$--$(ps]$ edges, and so the \oneEC property means they cannot be crossed by any $[sq]$--$[sq]$ edges.
Therefore, $[sq.p]$ is an $N$.

\finalequation{
  $LN[pso \; .\overline{O} \; .O \; \overline{PS}] \quad \cdotp N[sqp \; \overline{QP} \; \overline{SP} \; \overline{SQ}]$ \\
  $LN[pso \; .\overline{O} \; .\overline{O} \; \overline{P}S] \quad \cdotp N[sqp \; \overline{QP} \; \overline{SP} \; \overline{SQ}]$ \\
}

\subsection{Right}
Defined symmetrically to $L$.

\subsection{Neither}
Here we have the most flexibility in direct edges, though the structure of the decompositions means that we never have the case of both $op$ and $oq$ at the same time.

\begin{center}
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (m) at (3, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,dashed] (p.north) to (q.north);
  \draw [out=45,in=135] (q.north) to (o.north);
  \draw [out=45,in=135] (m.north) to (o.north);
\end{tikzpicture}
\\
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (m) at (3, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,dashed] (p.north) to (q.north);
  \draw [out=45,in=135] (p.north) to (o.north);
  \draw [out=45,in=135] (m.north) to (o.north);
\end{tikzpicture}
\end{center}

As in the $L$ case, we remove the $op$ or $oq$ edge first, then the $pq$ edge.
The definition of an $N$ item also means that any $N$ that has an $op$ or $oq$ edge also meets the criteria of having two $o$--$[pq]$ edges.

\finalequation{
  $\uwave{N}[pqo \; .O \; .\overline{O} \; \overline{PQ}] \leftarrow \max A[x \; i] \; \; N[pqo \; .\overline{O} \; .\overline{O} \; \overline{PQ}]$ \\
  $\uwave{N}[pqo \; .\overline{O} \; .\overline{O} \; P\overline{Q}] \leftarrow \max A[i \; x] \; \; N[pqo \; .\overline{O} \; .\overline{O} \; \overline{PQ}]$ \\
  $\uwave{N}[pqo \; .\overline{O} \; .O \; \overline{PQ}] \leftarrow \max A[x \; j] \; \; N[pqo \; .\overline{O} \; .\overline{O} \; \overline{PQ}]$ \\
  $\uwave{N}[pqo \; .\overline{O} \; .\overline{O} \; \overline{P}Q] \leftarrow \max A[j \; x] \; \; N[pqo \; .\overline{O} \; .\overline{O} \; \overline{PQ}]$ \\
  $N[pqo \; Q\overline{O} \; \overline{PO} \; \overline{PQ}] \leftarrow \max A[j \; i] \; \; N[pqo \; \overline{QO} \; \overline{PO} \; \overline{PQ}]$ \\
  $N[pqo \; \overline{QO} \; P\overline{O} \; \overline{PQ}] \leftarrow \max A[i \; j] \; \; N[pqo \; \overline{QO} \; \overline{PO} \; \overline{PQ}]$ \\
}

\begin{center}
\begin{tikzpicture}
  \node (p) at (1, 0) {\strut $p$};
  \node (m) at (3, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135,not allowed] (p.north) to (q.north);
  \draw [out=45,in=135,not allowed] (p.north) to (o.north);
  \draw [out=45,in=135,not allowed] (q.north) to (o.north);
  \draw [out=45,in=135] (m.north) to (o.north);
\end{tikzpicture}
\end{center}

Now we can consider the case with no direct edges.
As for $L$, we will define the split point based on the $o$--$(pq)$ edges.
The split point will be the endpoint furthest from $o$ (\myie leftmost or rightmost in $(pq)$, depending on which side $o$ is on).
The two sides are symmetrical, so we will only show the case with $o$ to the right here.
There are two cases, depending on how many edges are in the $o$--$(pq)$ set.

\begin{center}
\begin{tikzpicture}
  \node (label) at (-0.5, 0.5) {$|o$--$(pq)| > 1$ };
  \node (p) at (1, 0) {\strut $p$};
  \node (s) at (3, 0) {\strut $s$};
  \node (m) at (4, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (s.north) to (o.north);
  \draw [out=45,in=135] (m.north) to (o.north);
\end{tikzpicture}
\end{center}

There are no $(ps)$--$(sq)$ edges by definition, and no $o$--$[ps)$ edges by construction.
Therefore $[ps]$ is an $I$.
There are two $o$--$[sq)$ edges, and neither is crossed by a $(pq)$--$(pq)$ edge by definition, therefore $[sq.o]$ is an $N$.

\finalequation{
  $I[ps \; . \; .] \quad N\cdotp [sqo \; \overline{Q}O \; \overline{SO} \; \overline{SQ}]$ \\
  $I[ps \; . \; .] \quad N\cdotp [sqo \; \overline{QO} \; \overline{SO} \; S\overline{Q}]$
}

\begin{center}
\begin{tikzpicture}
  \node (label) at (-0.5, 0.5) {$|o$--$(pq)| = 1$ };
  \node (p) at (1, 0) {\strut $p$};
  \node (s) at (3, 0) {\strut $s$};
  \node (m) at (4, 0) {\strut};
  \node (q) at (5, 0) {\strut $q$};
  \node (o) at (6, 0) {\strut $o$};
  \node [fill=black,regular polygon, regular polygon sides=4,inner sep=1pt] at (o.north) {};
  \draw (p.north) -- (q.north);
  \draw [out=45,in=135] (s.north) to (o.north);
  \draw [out=45,in=135,not allowed] (m.north) to (o.north);
\end{tikzpicture}
\end{center}

The reasoning for $[ps]$ is the same as above.
For $[sq.o]$ we only have one $o$--$[sq]$ edge, namely $os$, and so this is an $X$.

\finalequation{
  $I[ps \; . \; .] \quad X\cdotp [sqo \; .O \; .\overline{O} \; \overline{SQ}]$ \\
  $I[ps \; . \; .] \quad X\cdotp [sqo \; .\overline{O} \; .\overline{O} \; S\overline{Q}]$
}

\subsection{Additional constraints}
The description above gives the complete decomposition, additional general rules are used to determine the specific rule set.
They are enforced by the code that converts the templates into all valid deduction rules:

\begin{itemize}
  \item Items cannot contain cycles.
  This also implies that every item must have at least one point without a parent.
  \item When combining two items, any points that will end up in the middle of the new span must have a parent in one of the items being combined.
\end{itemize}

Both of these can be enforced in the rule creation because we have the complete set of parent connections present in the definition of what combinations are allowed.

\section{Algorithm Properties}

\subsection{Derivational ambiguity}

One key difference between our algorithm and the original one-endpoint-crossing algorithm presented by \textcite{ec} is that we avoid spurious ambiguity in the ways a parse can be decomposed.
Most of the cases in which this ambiguity arises in \textcite{ec}'s algorithm are due to symmetry that is not explicitly broken.
For example, the choice of $t$ in the description of Intervals.
We resolved these issues by breaking such cases of symmetry, and altering the definitions of the items to ensure they cannot represent equivalent structures.
By avoiding derivational ambiguity we reduce the search space, and enable efficient summing over the space.

\subsection{Complexity}

Without any labels, our algorithm is $O(n^4)$, where $n$ is the length of the sentence.
This comes from all of the ternary deduction rules, which require two endpoints and two split points, and many of the binary deduction rules, which have two endpoints, a split point, and an external point.

Adding edge labels changes the complexity to $O(n^4 + e n^2)$, where $e$ is the number of edge types, and the second term comes from having to score every possible edge.
Adding spines, changes the complexity to $O(s^4 n^4 + e s^2 n^2)$, where $s$ is the number of spine types, though depending on features the second term could be simplified to either $e n^2$ or $s^2 n^2$.
In constituency parsing $e$ and $s$ are both around a thousand, making full enumeration of the dynamic program too slow in practice.
We resolve this issue through several types of pruning, described in the next section.

Finally, there is an important constant in the complexity, relating to the number of rules.
For any set of split points there are multiple items that could be combined.
Once our templates are expanded to show the possible state combinations there are 49,292 rules.

